<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Go Note - Leighj</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="leighj" /><meta name="description" content="golang学习笔记，基础知识，查漏补缺" /><meta name="keywords" content="golang, 学习笔记" />






<meta name="generator" content="Hugo" />





<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">


<link href="/dist/even.8fa4059e.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Go Note" />
<meta property="og:description" content="golang学习笔记，基础知识，查漏补缺" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://leighj.github.io/2019/07/25/go-note.html" />
<meta property="article:published_time" content="2019-07-25T11:11:24&#43;08:00"/>
<meta property="article:modified_time" content="2019-08-01T11:11:24&#43;08:00"/>

<meta itemprop="name" content="Go Note">
<meta itemprop="description" content="golang学习笔记，基础知识，查漏补缺">


<meta itemprop="datePublished" content="2019-07-25T11:11:24&#43;08:00" />
<meta itemprop="dateModified" content="2019-08-01T11:11:24&#43;08:00" />
<meta itemprop="wordCount" content="8744">



<meta itemprop="keywords" content="Go," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Go Note"/>
<meta name="twitter:description" content="golang学习笔记，基础知识，查漏补缺"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Leighj</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">首页</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">归档</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">标签</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">分类</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">关于</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Leighj</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">首页</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">归档</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">标签</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">分类</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">关于</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Go Note</h1>

      <div class="post-meta">
        <span class="post-time"> 2019-07-25 11:11 </span>
        <div class="post-category">
            <a href="/categories/Go/"> Go </a>
            </div>
          <span class="more-meta"> 约 8744 字 </span>
          <span class="more-meta"> 预计阅读 18 分钟 </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#go-语言特性">Go 语言特性</a></li>
<li><a href="#why-go">Why Go</a></li>
<li><a href="#基本类型">基本类型</a>
<ul>
<li><a href="#类型和变量"><strong>类型和变量</strong></a></li>
<li><a href="#控制语句"><strong>控制语句</strong></a></li>
<li><a href="#数组-值类型"><strong>数组(值类型)</strong></a></li>
<li><a href="#切片-slice-引用类型"><strong>切片 Slice(引用类型)</strong></a></li>
<li><a href="#map-引用类型"><strong>Map(引用类型)</strong></a></li>
<li><a href="#struct-值类型"><strong>Struct(值类型)</strong></a></li>
<li><a href="#字符串"><strong>字符串</strong></a></li>
<li><a href="#时间"><strong>时间</strong></a></li>
<li><a href="#命令行参数"><strong>命令行参数</strong></a></li>
<li><a href="#文件处理"><strong>文件处理</strong></a></li>
</ul></li>
<li><a href="#函数">函数</a>
<ul>
<li><a href="#func"><strong>func</strong></a></li>
<li><a href="#defer"><strong>defer</strong></a></li>
</ul></li>
<li><a href="#oop">OOP</a>
<ul>
<li><a href="#方法"><strong>方法</strong></a></li>
<li><a href="#接口"><strong>接口</strong></a></li>
<li><a href="#类似封装-继承-多态的特性"><strong>类似封装，继承，多态的特性</strong></a></li>
</ul></li>
<li><a href="#协程-管道-select">协程，管道，Select</a>
<ul>
<li><a href="#goroutine"><strong>goroutine</strong></a></li>
<li><a href="#管道channel-引用类型"><strong>管道channel(引用类型)</strong></a></li>
<li><a href="#select"><strong>Select</strong></a></li>
<li><a href="#定时器和打点器"><strong>定时器和打点器</strong></a></li>
</ul></li>
<li><a href="#其他">其他</a>
<ul>
<li><a href="#反射reflection"><strong>反射Reflection</strong></a></li>
<li><a href="#redis"><strong>Redis</strong></a></li>
<li><a href="#正则"><strong>正则</strong></a></li>
</ul></li>
<li><a href="#test用例">Test用例</a>
<ul>
<li><a href="#单元测试"><strong>单元测试</strong></a></li>
<li><a href="#性能测试benchmark"><strong>性能测试Benchmark</strong></a></li>
</ul></li>
<li><a href="#special-tips"><strong>Special Tips</strong></a></li>
<li><a href="#go为数不多的陷阱"><strong>Go为数不多的陷阱</strong></a></li>
</ul></li>
</ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <blockquote>
<p>golang笔记，基础知识，查漏补缺</p>
</blockquote>

<h2 id="go-语言特性">Go 语言特性</h2>

<ul>
<li>没有继承</li>
<li>强制类型</li>
<li>没有错误处理</li>
<li>支持UTF-8</li>
</ul>

<h2 id="why-go">Why Go</h2>

<ul>
<li>学习曲线</li>
<li>团队开发工具</li>
<li>部署环境</li>
<li>系统效能</li>
</ul>

<h2 id="基本类型">基本类型</h2>

<h3 id="类型和变量"><strong>类型和变量</strong></h3>

<table>
<thead>
<tr>
<th>类型</th>
<th>长度</th>
<th>默认值</th>
<th>说明</th>
</tr>
</thead>

<tbody>
<tr>
<td>bool</td>
<td>1</td>
<td>false</td>
<td></td>
</tr>

<tr>
<td>byte</td>
<td>1</td>
<td>0</td>
<td>uint8</td>
</tr>

<tr>
<td>rune</td>
<td>4</td>
<td>0</td>
<td></td>
</tr>

<tr>
<td>int,uint</td>
<td>4|8</td>
<td>0</td>
<td></td>
</tr>

<tr>
<td>Int8,uint8</td>
<td>1</td>
<td>0</td>
<td>0~255,-128~127</td>
</tr>

<tr>
<td>Int16,uint16</td>
<td>2</td>
<td>0</td>
<td>0~65535,-32768~32767</td>
</tr>

<tr>
<td>Int32,uint32</td>
<td>4</td>
<td>0</td>
<td>0 ~ 42亿,-21亿~ 21亿</td>
</tr>

<tr>
<td>Int64,uint64</td>
<td>8</td>
<td>0</td>
<td></td>
</tr>

<tr>
<td>float32</td>
<td>4</td>
<td>0.0</td>
<td></td>
</tr>

<tr>
<td>Float64</td>
<td>8</td>
<td>0.0</td>
<td></td>
</tr>

<tr>
<td>complex64</td>
<td>8</td>
<td></td>
<td></td>
</tr>

<tr>
<td>complex128</td>
<td>16</td>
<td></td>
<td></td>
</tr>

<tr>
<td>uintptr</td>
<td>4|8</td>
<td></td>
<td>以存储指针的 uint32 或 uint64 整数</td>
</tr>

<tr>
<td>array</td>
<td></td>
<td></td>
<td>值类型</td>
</tr>

<tr>
<td>string</td>
<td></td>
<td>&rdquo;&rdquo;</td>
<td>utf8字符串，不可改变类型</td>
</tr>

<tr>
<td>struct</td>
<td></td>
<td></td>
<td>值类型</td>
</tr>

<tr>
<td>slice</td>
<td></td>
<td>nil</td>
<td>引用类型(被引用的变量存储在堆区中)</td>
</tr>

<tr>
<td>map</td>
<td></td>
<td>nil</td>
<td>引用类型(被引用的变量存储在堆区中)</td>
</tr>

<tr>
<td>channel</td>
<td></td>
<td>nil</td>
<td>引用类型(被引用的变量存储在堆区中)</td>
</tr>

<tr>
<td>interface</td>
<td></td>
<td>nil</td>
<td>接口</td>
</tr>

<tr>
<td>function</td>
<td></td>
<td>nil</td>
<td>函数</td>
</tr>
</tbody>
</table>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// 关键字
</span><span class="c1"></span><span class="k">break</span>      <span class="k">default</span>       <span class="kd">func</span>     <span class="kd">interface</span>   <span class="k">select</span>
<span class="k">case</span>       <span class="k">defer</span>         <span class="k">go</span>       <span class="kd">map</span>         <span class="kd">struct</span>
<span class="kd">chan</span>       <span class="k">else</span>          <span class="k">goto</span>     <span class="kn">package</span>     <span class="k">switch</span>
<span class="kd">const</span>      <span class="k">fallthrough</span>   <span class="k">if</span>       <span class="k">range</span>       <span class="kd">type</span>
<span class="k">continue</span>   <span class="k">for</span>           <span class="kn">import</span>   <span class="k">return</span>      <span class="kd">var</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">//  内部预定义字段
</span><span class="c1"></span><span class="nx">内建常量</span><span class="p">:</span> <span class="kc">true</span> <span class="kc">false</span> <span class="kc">iota</span> <span class="kc">nil</span>

<span class="nx">内建类型</span><span class="p">:</span> <span class="kt">int</span> <span class="kt">int8</span> <span class="kt">int16</span> <span class="kt">int32</span> <span class="kt">int64</span>
        <span class="kt">uint</span> <span class="kt">uint8</span> <span class="kt">uint16</span> <span class="kt">uint32</span> <span class="kt">uint64</span> <span class="kt">uintptr</span>
        <span class="kt">float32</span> <span class="kt">float64</span> <span class="kt">complex128</span> <span class="kt">complex64</span>
        <span class="kt">bool</span> <span class="kt">byte</span> <span class="kt">rune</span> <span class="kt">string</span> <span class="kt">error</span>

<span class="nx">内建函数</span><span class="p">:</span> <span class="nx">make</span> <span class="nx">len</span> <span class="nx">cap</span> <span class="nx">new</span> <span class="nx">append</span> <span class="nx">copy</span> <span class="nx">close</span> <span class="nx">delete</span>
        <span class="nx">complex</span> <span class="nx">real</span> <span class="nx">imag</span>
        <span class="nx">panic</span> <span class="nx">recover</span>

 </code></pre></td></tr></table>
</div>
</div>
<h3 id="控制语句"><strong>控制语句</strong></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// for 三种形式
</span><span class="c1"></span><span class="nx">s</span> <span class="o">:=</span> <span class="s">&#34;abc&#34;</span>
<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">s</span><span class="p">);</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
    <span class="nb">println</span><span class="p">(</span><span class="nx">s</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
<span class="p">}</span>

<span class="nx">n</span> <span class="o">:=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>
<span class="k">for</span> <span class="nx">n</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
    <span class="nb">println</span><span class="p">(</span><span class="nx">s</span><span class="p">[</span><span class="nx">n</span><span class="p">])</span>
    <span class="nx">n</span><span class="o">--</span>
<span class="p">}</span>

<span class="k">for</span> <span class="p">{</span> <span class="c1">//类似while
</span><span class="c1"></span>    <span class="nb">println</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>
<span class="p">}</span>

<span class="err">#</span> <span class="k">switch</span> <span class="nx">三种表达式</span><span class="p">,</span><span class="nx">不需要break</span>
<span class="err">#</span> <span class="nx">要执行后续case</span> <span class="k">fallthrough</span>
<span class="err">#</span> <span class="nx">支持初始化表达式</span>
<span class="k">switch</span> <span class="nx">switch_a</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">{</span>
<span class="k">case</span> <span class="nx">switch_a</span> <span class="p">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;a &gt; 0&#34;</span><span class="p">)</span>
    <span class="k">fallthrough</span>
<span class="k">case</span> <span class="nx">switch_a</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;a = 1&#34;</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">switch</span> <span class="p">{</span>
<span class="k">case</span> <span class="nx">condition1</span><span class="p">:</span>
    <span class="o">...</span>
<span class="k">case</span> <span class="nx">condition2</span><span class="p">:</span>
    <span class="o">...</span>
<span class="k">default</span><span class="p">:</span>
    <span class="o">...</span>
<span class="p">}</span>

<span class="k">switch</span> <span class="nx">result</span><span class="o">:=</span><span class="nf">calculate</span><span class="p">()</span> <span class="p">{</span>
<span class="k">case</span> <span class="nx">result</span><span class="p">&lt;</span><span class="mi">0</span><span class="p">:</span>
    <span class="o">...</span>
<span class="k">case</span> <span class="nx">result</span><span class="p">&gt;</span><span class="mi">0</span><span class="p">:</span>
    <span class="o">...</span>
<span class="k">default</span><span class="p">:</span>
    <span class="o">...</span>
<span class="p">}</span>

<span class="err">#</span> <span class="nx">跳转语句</span> <span class="k">goto</span><span class="err">，</span><span class="k">break</span><span class="err">，</span><span class="k">continue</span>
<span class="err">#</span> <span class="nx">三个语法都可以配合标签使用</span>
<span class="nx">LABEL</span><span class="p">:</span>
    <span class="k">for</span> <span class="nx">L_a</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">L_a</span> <span class="p">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="nx">L_a</span><span class="o">++</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">{</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">L_a</span><span class="p">)</span>
            <span class="k">continue</span> <span class="nx">LABEL</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="p">{</span>
        <span class="k">for</span> <span class="nx">L_a</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">L_a</span> <span class="p">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="nx">L_a</span><span class="o">++</span> <span class="p">{</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">L_a</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">goto</span> <span class="nx">LABEL1</span>
    <span class="p">}</span>
<span class="nx">LABEL1</span><span class="p">:</span>

 </code></pre></td></tr></table>
</div>
</div>
<h3 id="数组-值类型"><strong>数组(值类型)</strong></h3>

<ul>
<li>初始化的方式</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">var</span> <span class="nx">numArr01</span> <span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="kt">int</span> <span class="p">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">}</span>
<span class="kd">var</span> <span class="nx">numArr02</span> <span class="p">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">}</span>
<span class="kd">var</span> <span class="nx">numArr03</span> <span class="p">=</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">}</span>
<span class="kd">var</span> <span class="nx">numArr04</span> <span class="p">=</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="mi">800</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">900</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="mi">999</span><span class="p">}</span>
<span class="nx">strArr05</span> <span class="o">:=</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;a&#34;</span><span class="p">,</span><span class="s">&#34;b&#34;</span><span class="p">,</span><span class="s">&#34;c&#34;</span><span class="p">}</span>

 </code></pre></td></tr></table>
</div>
</div>
<ul>
<li>多维数组</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">var</span> <span class="nx">arr</span> <span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="kt">int</span>
<span class="nx">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="p">=</span> <span class="mi">10</span>

<span class="kd">var</span> <span class="nx">arr</span> <span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="kt">int</span> <span class="p">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="kt">int</span><span class="p">{{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">},{</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">}}</span>
<span class="kd">var</span> <span class="nx">arr</span> <span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="kt">int</span> <span class="p">=</span> <span class="p">[</span><span class="o">...</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="kt">int</span><span class="p">{{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">},{</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">}}</span>
<span class="kd">var</span> <span class="nx">arr</span> <span class="p">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="kt">int</span><span class="p">{{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">},{</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">}}</span>
<span class="kd">var</span> <span class="nx">arr</span> <span class="p">=</span> <span class="p">[</span><span class="o">...</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="kt">int</span><span class="p">{{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">},{</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">}}</span>

<span class="kd">const</span><span class="p">(</span>
  <span class="nx">WIDTH</span><span class="p">=</span><span class="mi">10</span>
  <span class="nx">HEIGHT</span><span class="p">=</span><span class="mi">20</span>
<span class="p">)</span>

<span class="kd">type</span> <span class="nx">pixel</span> <span class="kt">int</span>
<span class="kd">var</span> <span class="nx">screen</span> <span class="p">[</span><span class="nx">WIDTH</span><span class="p">][</span><span class="nx">HEIGHT</span><span class="p">]</span><span class="nx">pixel</span>

 </code></pre></td></tr></table>
</div>
</div>
<ul>
<li>指向数组的指针和指针数组</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">var</span> <span class="nx">arr1</span> <span class="p">=</span> <span class="nb">new</span><span class="p">([</span><span class="mi">5</span><span class="p">]</span><span class="kt">int</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">arr2</span> <span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="kt">int</span>
<span class="nx">arr1的类型是</span><span class="o">*</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="kt">int</span>
<span class="nx">arr2的类型是</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="kt">int</span>

<span class="err">#</span> <span class="nx">指向数组的指针</span>
<span class="nx">a</span> <span class="o">:=</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">}</span>
<span class="kd">var</span> <span class="nx">p</span> <span class="o">*</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="kt">int</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">a</span>

<span class="err">#</span> <span class="nx">指针数组</span>
<span class="nx">x</span><span class="p">,</span><span class="nx">y</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span>
<span class="nx">a</span> <span class="o">:=</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="o">*</span><span class="kt">int</span><span class="p">{</span><span class="o">&amp;</span><span class="nx">x</span><span class="p">,</span><span class="o">&amp;</span><span class="nx">y</span><span class="p">}</span>

 </code></pre></td></tr></table>
</div>
</div>
<h3 id="切片-slice-引用类型"><strong>切片 Slice(引用类型)</strong></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// 本质是一个数据结构(struct结构体)
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">slice</span> <span class="kd">struct</span><span class="p">{</span>
    <span class="nx">ptr</span> <span class="o">*</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="kt">int</span>
    <span class="nx">len</span> <span class="kt">int</span>
    <span class="nx">cap</span> <span class="kt">int</span>
<span class="p">}</span>

 </code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// 方式1
</span><span class="c1"></span><span class="kd">var</span> <span class="nx">intArr</span> <span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="kt">int</span> <span class="p">=</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">}</span>
<span class="nx">slice</span> <span class="o">:=</span> <span class="nx">intArr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="c1">//左闭右开 slice = [2,3]
</span><span class="c1">// 方式2
</span><span class="c1"></span><span class="nx">slice_a</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kd">type</span><span class="p">,</span><span class="nx">len</span><span class="p">,[</span><span class="nx">cap</span><span class="p">])</span>
<span class="c1">// 方式3
</span><span class="c1"></span><span class="nx">slice_b</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">}</span>
<span class="kd">var</span> <span class="nx">slice_c</span> <span class="p">[]</span><span class="kt">string</span> <span class="p">=</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;tom&#34;</span><span class="p">,</span><span class="s">&#34;leighj&#34;</span><span class="p">}</span>
<span class="c1">//
</span><span class="c1"></span><span class="kd">var</span> <span class="nx">slice</span> <span class="p">[]</span><span class="kt">int</span> <span class="c1">//创建一个空的slice，cap和len都是0
</span><span class="c1"></span><span class="nx">slice</span> <span class="o">==</span> <span class="kc">nil</span> <span class="c1">//true
</span><span class="c1"></span><span class="nx">slice</span> <span class="p">=</span> <span class="p">[]</span><span class="kt">int</span><span class="p">{}</span>
<span class="nx">slice</span> <span class="o">==</span> <span class="kc">nil</span> <span class="c1">// false
</span><span class="c1"></span>

<span class="c1">//slice 之间无法比较 不能使用==
</span><span class="c1"></span>
<span class="c1">//组成多维数据结构，内部的slice长度可以不一致，这一点和数组不同
</span><span class="c1"></span><span class="nx">twoD</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([][]</span><span class="kt">int</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
    <span class="nx">innerLen</span> <span class="o">:=</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="nx">twoD</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="p">=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span> <span class="nx">innerLen</span><span class="p">)</span>
    <span class="k">for</span> <span class="nx">j</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="p">&lt;</span> <span class="nx">innerLen</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span> <span class="p">{</span>
        <span class="nx">twoD</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="p">]</span> <span class="p">=</span> <span class="nx">i</span> <span class="o">+</span> <span class="nx">j</span>
    <span class="p">}</span>
<span class="p">}</span>

 </code></pre></td></tr></table>
</div>
</div>
<ul>
<li><p>slice定义完还不能使用，需要引用到一个数组或make一个空间</p></li>

<li><p>append</p></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">//append底层原理：先创建数组阔容，将原来的元素拷贝到新数组，追加新的元素，然后slice重新引用到这个数组
</span><span class="c1"></span><span class="kd">var</span> <span class="nx">slice</span> <span class="p">[]</span><span class="kt">int</span> <span class="p">=</span> <span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">}</span>
<span class="nx">slice</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">slice</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>
<span class="nx">slice</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">slice</span><span class="p">,</span><span class="nx">slice</span><span class="o">...</span><span class="p">)</span>

 </code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">slice</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">}</span>
<span class="nx">x</span> <span class="o">:=</span> <span class="nf">min</span><span class="p">(</span><span class="nx">slice</span><span class="o">...</span><span class="p">)</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;The minimum in the slice is: %d\n&#34;</span><span class="p">,</span> <span class="nx">x</span><span class="p">)</span>

<span class="kd">func</span> <span class="nf">min</span><span class="p">(</span><span class="nx">s</span> <span class="o">...</span><span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="p">}</span>
    <span class="nx">min</span> <span class="o">:=</span> <span class="nx">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">v</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">s</span> <span class="p">{</span>
        <span class="k">if</span> <span class="nx">v</span> <span class="p">&lt;</span> <span class="nx">min</span> <span class="p">{</span>
            <span class="nx">min</span> <span class="p">=</span> <span class="nx">v</span>
        <span class="p">}</span>
    <span class="p">}</span>
        <span class="k">return</span> <span class="nx">min</span>
<span class="p">}</span>
<span class="c1">// 切片重新分片，只能向后移，不能向前移
</span><span class="c1"></span><span class="nx">s1</span> <span class="p">=</span> <span class="nx">slice</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="c1">// s1=[9,3]
</span><span class="c1"></span><span class="nx">s2</span> <span class="p">=</span> <span class="nx">s1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="c1">// s2=[9,3,5,1]
</span><span class="c1"></span>
 </code></pre></td></tr></table>
</div>
</div>
<h3 id="map-引用类型"><strong>Map(引用类型)</strong></h3>

<ul>
<li>声明</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">var</span> <span class="nx">a</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span>
<span class="c1">// 在使用map前一定要先make，这里和数组不同。定义map的时候没有分配内存
</span><span class="c1"></span>
 </code></pre></td></tr></table>
</div>
</div>
<ul>
<li>make</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">var</span> <span class="nx">map_a</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span>
<span class="nx">map_a</span> <span class="p">=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="nx">map_b</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="kt">string</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="nx">map_c</span> <span class="o">:=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s">&#34;b&#34;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="s">&#34;c&#34;</span><span class="p">}</span>

<span class="c1">// map
</span><span class="c1"></span><span class="nx">studentMap</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">)</span>
<span class="nx">studentMap</span><span class="p">[</span><span class="s">&#34;st1&#34;</span><span class="p">]</span> <span class="p">=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">)</span>
<span class="nx">studentMap</span><span class="p">[</span><span class="s">&#34;st1&#34;</span><span class="p">][</span><span class="s">&#34;name&#34;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&#34;tom&#34;</span>
<span class="nx">studentMap</span><span class="p">[</span><span class="s">&#34;st1&#34;</span><span class="p">][</span><span class="s">&#34;sex&#34;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&#34;woman&#34;</span>
<span class="nx">studentMap</span><span class="p">[</span><span class="s">&#34;st1&#34;</span><span class="p">][</span><span class="s">&#34;address&#34;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&#34;北京&#34;</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">studentMap</span><span class="p">)</span> <span class="c1">// map[st1:map[sex:woman address:北京 name:tom]]
</span><span class="c1"></span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">studentMap</span><span class="p">[</span><span class="s">&#34;st1&#34;</span><span class="p">][</span><span class="s">&#34;address&#34;</span><span class="p">])</span> <span class="c1">// 北京
</span><span class="c1"></span>
 </code></pre></td></tr></table>
</div>
</div>
<ul>
<li><p>map的增删改查</p>

<ul>
<li>Key-value形式存储数据，key不会重复，key-value是无序的</li>
<li>键值对不存在时自动添加，使用delete()删除键值对</li>
</ul></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// 判断key是否存在
</span><span class="c1"></span><span class="nx">val</span><span class="p">,</span><span class="nx">ok</span> <span class="o">:=</span> <span class="nx">map1</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
<span class="nx">cities</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">)</span>
<span class="nx">cities</span><span class="p">[</span><span class="s">&#34;no1&#34;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&#34;北京&#34;</span>
<span class="nx">cities</span><span class="p">[</span><span class="s">&#34;no1&#34;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&#34;上海&#34;</span>
<span class="nx">cities</span><span class="p">[</span><span class="s">&#34;no2&#34;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&#34;杭州&#34;</span>
<span class="nb">delete</span><span class="p">(</span><span class="kd">map</span><span class="p">,</span><span class="s">&#34;key&#34;</span><span class="p">)</span>
<span class="c1">// 查找
</span><span class="c1"></span><span class="nx">val</span><span class="p">,</span><span class="nx">ok</span> <span class="o">:=</span> <span class="nx">cities</span><span class="p">[</span><span class="s">&#34;no2]
</span><span class="s">if ok {
</span><span class="s">    fmt.Printf(&#34;</span><span class="nx">find</span> <span class="o">%</span><span class="nx">v</span><span class="s">&#34;,val)
</span><span class="s">}else{
</span><span class="s">    fmt.Print(&#34;</span><span class="nx">not</span> <span class="nx">find</span><span class="err">&#34;</span><span class="p">)</span>
<span class="p">}</span>

 </code></pre></td></tr></table>
</div>
</div>
<ul>
<li>slice of map</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">var</span> <span class="nx">monsters</span> <span class="p">[]</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span>
<span class="nx">monsters</span> <span class="p">=</span> <span class="nb">make</span><span class="p">([]</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="c1">//slice需要make
</span><span class="c1"></span><span class="k">if</span> <span class="nx">monsters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
    <span class="nx">monsters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="c1">// map需要make
</span><span class="c1"></span>    <span class="nx">monsters</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#34;name&#34;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&#34;lei&#34;</span>
    <span class="nx">monsters</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#34;age&#34;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&#34;12&#34;</span>
<span class="p">}</span>
<span class="k">if</span> <span class="nx">monsters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
    <span class="nx">monsters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="c1">// map需要make
</span><span class="c1"></span>    <span class="nx">monsters</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s">&#34;name&#34;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&#34;tom&#34;</span>
    <span class="nx">monsters</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s">&#34;age&#34;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&#34;13&#34;</span>
<span class="p">}</span>

<span class="c1">// 初始化的容量是2，继续按下标添加会越界，用append解决动态添加的问题
</span><span class="c1"></span><span class="nx">newMonster</span> <span class="o">:=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span>
    <span class="s">&#34;name&#34;</span><span class="p">:</span> <span class="s">&#34;kely&#34;</span><span class="p">,</span>
    <span class="s">&#34;age&#34;</span><span class="p">:</span>  <span class="s">&#34;100&#34;</span><span class="p">,</span>
<span class="p">}</span>

<span class="nx">monsters</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">monsters</span><span class="p">,</span> <span class="nx">newMonster</span><span class="p">)</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">monsters</span><span class="p">)</span>

 </code></pre></td></tr></table>
</div>
</div>
<ul>
<li>Sort</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// 对map间接排序
</span><span class="c1"></span><span class="nx">map_a</span> <span class="o">:=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s">&#34;b&#34;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="s">&#34;c&#34;</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="s">&#34;d&#34;</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span> <span class="s">&#34;e&#34;</span><span class="p">}</span>
<span class="nx">slice_a</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nx">map_a</span><span class="p">))</span>
<span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">map_a</span> <span class="p">{</span>
    <span class="nx">slice_a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="p">=</span> <span class="nx">k</span>
    <span class="nx">i</span><span class="o">++</span>
<span class="p">}</span>
<span class="nx">sort</span><span class="p">.</span><span class="nf">Ints</span><span class="p">(</span><span class="nx">slice_a</span><span class="p">)</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">slice_a</span><span class="p">)</span>

<span class="c1">// 转换map的key-value
</span><span class="c1"></span><span class="nx">map_1</span> <span class="o">:=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s">&#34;b&#34;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="s">&#34;c&#34;</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="s">&#34;d&#34;</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span> <span class="s">&#34;e&#34;</span><span class="p">}</span>
<span class="nx">map_2</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span><span class="p">)</span>

<span class="k">for</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">map_1</span> <span class="p">{</span>
    <span class="nx">map_2</span><span class="p">[</span><span class="nx">v</span><span class="p">]</span> <span class="p">=</span> <span class="nx">k</span>
<span class="p">}</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">map_2</span><span class="p">)</span>

 </code></pre></td></tr></table>
</div>
</div>
<ul>
<li>value 更多的是使用struct</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">Stu</span> <span class="kd">struct</span><span class="p">{</span>
    <span class="nx">Name</span> <span class="kt">string</span>
    <span class="nx">Age</span> <span class="kt">int</span>
    <span class="nx">Add</span> <span class="kt">string</span>
<span class="p">}</span>

<span class="nx">students</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">Stu</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
<span class="nx">stu1</span> <span class="o">:=</span> <span class="nx">Stu</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="s">&#34;leighj&#34;</span><span class="p">,</span><span class="nx">Age</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="nx">Add</span><span class="p">:</span><span class="s">&#34;aaa&#34;</span><span class="p">}</span>
<span class="nx">stu2</span> <span class="o">:=</span> <span class="nx">Stu</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="s">&#34;tom&#34;</span><span class="p">,</span><span class="nx">Age</span><span class="p">:</span><span class="mi">11</span><span class="p">,</span><span class="nx">Add</span><span class="p">:</span><span class="s">&#34;bbb&#34;</span><span class="p">}</span>
<span class="nx">students</span><span class="p">[</span><span class="s">&#34;st1&#34;</span><span class="p">]</span> <span class="p">=</span> <span class="nx">stu1</span>
<span class="nx">students</span><span class="p">[</span><span class="s">&#34;st2&#34;</span><span class="p">]</span> <span class="p">=</span> <span class="nx">stu2</span>

<span class="k">for</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">students</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;student&#39;s num=%v\n&#34;</span><span class="p">,</span> <span class="nx">k</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;student&#39;s name=%v\n&#34;</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">()</span>
<span class="p">}</span>

 </code></pre></td></tr></table>
</div>
</div>
<ul>
<li>Import!</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">//当 map 因扩张重新哈希时，各键值项存储位置都会发改变。
</span><span class="c1">//因此，map被设计成 not addressable。
</span><span class="c1">//类似 m[1].name 这种期望透过原 value 指针修改成员的行为自然会被禁
</span><span class="c1"></span>
<span class="kd">type</span> <span class="nx">use</span> <span class="kd">struct</span><span class="p">{</span>
    <span class="nx">name</span> <span class="kt">string</span>
<span class="p">}</span>
<span class="nx">m</span><span class="o">:=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="nx">user</span><span class="p">{</span>
    <span class="mi">1</span><span class="p">:{</span><span class="s">&#34;user1&#34;</span><span class="p">},</span>
<span class="p">}</span>

<span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">name</span> <span class="p">=</span> <span class="s">&#34;tom&#34;</span> <span class="c1">// Error: cannot assign to m[1].name
</span><span class="c1"></span>
<span class="c1">// 正确的做法是完整替换value或者使用指针
</span><span class="c1"></span><span class="nx">u</span><span class="o">:=</span> <span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="nx">u</span><span class="p">.</span><span class="nx">name</span> <span class="p">=</span> <span class="s">&#34;jack&#34;</span>
<span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">=</span> <span class="nx">u</span> <span class="c1">//替换value
</span><span class="c1"></span>
<span class="nx">m2</span> <span class="o">:=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="o">*</span><span class="nx">user</span><span class="p">{</span>
    <span class="mi">1</span><span class="p">:</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">{</span><span class="s">&#34;user1&#34;</span><span class="p">},</span>
<span class="p">}</span>
<span class="nx">m2</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">name</span> <span class="p">=</span> <span class="s">&#34;jack&#34;</span> <span class="c1">// 返回的是指针复制品。透过指针修改原对象是允许的
</span><span class="c1"></span>
 </code></pre></td></tr></table>
</div>
</div>
<h3 id="struct-值类型"><strong>Struct(值类型)</strong></h3>

<ul>
<li>结构体的所有字段在内存中是连续的</li>
<li>结构间的赋值与比较，必须是完全相同的字段</li>
<li>允许强制转换</li>
<li>struct的每个字段上，可以写上一个tag，该tag可以通过反射机制获取。常见的使用场景就是序
列化和反序列化。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">person</span> <span class="kd">struct</span><span class="p">{</span>
    <span class="nx">Name</span> <span class="kt">string</span>
    <span class="nx">Age</span> <span class="kt">int</span>
    <span class="nx">Scores</span> <span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="kt">float64</span>
    <span class="nx">ptr</span> <span class="o">*</span><span class="kt">int</span>
    <span class="nx">slice</span> <span class="p">[]</span><span class="kt">int</span>
    <span class="kd">map</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span>
<span class="p">}</span>
<span class="c1">// 如果结构体的字段类型是： 指针，slice，map的零值都是nil，没有分配空间，实用的时候要先make
</span><span class="c1"></span>
 </code></pre></td></tr></table>
</div>
</div>
<ul>
<li>嵌入结构</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// 匿名结构体
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">human</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">Sex</span> <span class="kt">int</span>
<span class="p">}</span>
<span class="kd">type</span> <span class="nx">techer</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">human</span>
    <span class="nx">Name</span> <span class="kt">string</span>
    <span class="nx">Age</span> <span class="kt">int</span>
<span class="p">}</span>
<span class="kd">type</span> <span class="nx">student</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">human</span>
    <span class="nx">Name</span> <span class="kt">string</span>
    <span class="nx">Age</span> <span class="kt">int</span>
<span class="p">}</span>
<span class="nx">a</span> <span class="o">:=</span> <span class="nx">teacher</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="s">&#34;joe&#34;</span><span class="p">,</span><span class="nx">Age</span><span class="p">:</span><span class="mi">19</span><span class="p">,</span><span class="nx">human</span><span class="p">:</span><span class="nx">human</span><span class="p">{</span><span class="nx">Sex</span><span class="p">:</span><span class="mi">0</span><span class="p">}}</span>
<span class="nx">a</span> <span class="o">:=</span> <span class="nx">student</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="s">&#34;joe&#34;</span><span class="p">,</span><span class="nx">Age</span><span class="p">:</span><span class="mi">19</span><span class="p">,</span><span class="nx">human</span><span class="p">:</span><span class="nx">human</span><span class="p">{</span><span class="nx">Sex</span><span class="p">:</span><span class="mi">1</span><span class="p">}}</span>

 </code></pre></td></tr></table>
</div>
</div>
<ul>
<li>创建结构体变量时指定字段值</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">Student</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="kt">string</span>
    <span class="nx">Age</span>  <span class="kt">int</span>
<span class="p">}</span>
<span class="kd">var</span> <span class="nx">st1</span> <span class="p">=</span> <span class="nx">Student</span><span class="p">{</span><span class="s">&#34;leighj&#34;</span><span class="p">,</span> <span class="mi">30</span><span class="p">}</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">st1</span><span class="p">)</span> <span class="c1">// {leighj 30}
</span><span class="c1"></span><span class="kd">var</span> <span class="nx">st2</span> <span class="p">=</span> <span class="nx">Student</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span> <span class="s">&#34;leighj&#34;</span><span class="p">,</span> <span class="nx">Age</span><span class="p">:</span> <span class="mi">30</span><span class="p">}</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">st2</span><span class="p">)</span> <span class="c1">// {leighj 30}
</span><span class="c1">// 返回结构体的指针类型
</span><span class="c1"></span><span class="kd">var</span> <span class="nx">st3</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">Student</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span> <span class="s">&#34;leighj&#34;</span><span class="p">,</span> <span class="nx">Age</span><span class="p">:</span> <span class="mi">30</span><span class="p">}</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="o">*</span><span class="nx">st3</span><span class="p">)</span> <span class="c1">// {leighj 30}
</span><span class="c1"></span>
 </code></pre></td></tr></table>
</div>
</div>
<ul>
<li>用工厂模式解决 <strong>没有构造函数</strong> 的问题</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">model</span>
<span class="kd">type</span> <span class="nx">student</span> <span class="kd">struct</span><span class="p">{</span>
    <span class="nx">Name</span> <span class="kt">string</span>
    <span class="nx">Score</span> <span class="kt">float64</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">NewStudent</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">,</span><span class="nx">score</span> <span class="kt">float64</span><span class="p">)</span> <span class="o">*</span><span class="nx">student</span><span class="p">{</span>
    <span class="k">return</span> <span class="o">&amp;</span><span class="nx">student</span><span class="p">{</span>
        <span class="nx">Name</span><span class="p">:</span><span class="nx">name</span><span class="p">,</span>
        <span class="nx">Score</span><span class="p">:</span><span class="nx">score</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span><span class="p">(</span><span class="s">&#34;model&#34;</span><span class="p">)</span>

<span class="nx">vat</span> <span class="nx">st</span> <span class="p">=</span> <span class="nx">model</span><span class="p">.</span><span class="nf">NewStudent</span><span class="p">(</span><span class="s">&#34;leighj&#34;</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span>
 </code></pre></td></tr></table>
</div>
</div>
<ul>
<li>类型断言</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">val</span><span class="p">.(</span><span class="kd">type</span><span class="p">)</span>

<span class="k">for</span> <span class="nf">classifier</span><span class="p">(</span><span class="nx">items</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{}){</span>
    <span class="k">for</span> <span class="nx">i</span><span class="p">,</span><span class="nx">x</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">items</span><span class="p">{</span>
        <span class="k">switch</span> <span class="nx">x</span><span class="p">.(</span><span class="kd">type</span><span class="p">){</span>
        <span class="k">case</span> <span class="kt">bool</span><span class="p">:</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;param #%d is a bool\n&#34;</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span>
        <span class="k">case</span> <span class="kt">float64</span><span class="p">:</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;param #%d is a float64\n&#34;</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span>
        <span class="k">case</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int64</span><span class="p">:</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;param #%d is an int\n&#34;</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span>
        <span class="k">case</span> <span class="kc">nil</span><span class="p">:</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;param #%d is nil\n&#34;</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span>
        <span class="k">case</span> <span class="kt">string</span><span class="p">:</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;param #%d is a string\n&#34;</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span>
        <span class="k">default</span><span class="p">:</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;param #%d’s type is unknown\n&#34;</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

 </code></pre></td></tr></table>
</div>
</div>
<ul>
<li>实现set数据结构</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">var</span> <span class="nx">null</span> <span class="kd">struct</span><span class="p">{}</span>
<span class="nx">set</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">struct</span><span class="p">{})</span>
<span class="nx">set</span><span class="p">[</span><span class="s">&#34;a&#34;</span><span class="p">]</span> <span class="p">=</span> <span class="nx">null</span>

 </code></pre></td></tr></table>
</div>
</div>
<h3 id="字符串"><strong>字符串</strong></h3>

<ul>
<li><p>底层是一个byte数组，因此string也可以进行切片处理</p></li>

<li><p>遍历,修改  都需要  将其转换成[]rune或者[]byte，处理后，再转回string。</p></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">s</span> <span class="o">:=</span> <span class="s">&#34;abc汉字&#34;</span>
<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">s</span><span class="p">);</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span> <span class="c1">// byte
</span><span class="c1"></span>    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;%c,&#34;</span><span class="p">,</span> <span class="nx">s</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
<span class="p">}</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">()</span>
<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">r</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">s</span> <span class="p">{</span> <span class="c1">// rune
</span><span class="c1"></span>    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;%c,&#34;</span><span class="p">,</span> <span class="nx">r</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// 无论哪种转换都会重现分配内存，并复制字节数组
</span><span class="c1"></span>
 </code></pre></td></tr></table>
</div>
</div>
<ul>
<li><p>字符串转整数 strconv.Atoi()</p></li>

<li><p>整数转字符串 strconv.Itoa()</p></li>

<li><p>字符串转byte []byte(&ldquo;go&rdquo;)</p></li>

<li><p>[]byte转字符串 string([]byte{97,98,99})</p></li>

<li><p>10进制转2，8，16 strconv.FormatInt(i int64,base int) string</p></li>

<li><p>字符串是否包含 strings.Contains(s,substr string) bool</p></li>

<li><p>字符出现的次数 strings.Count(s,substr string) int</p></li>

<li><p>不区分大小写的字符比较 strings.EqualFold(s,t string) bool</p></li>

<li><p>字串在字符串第一次出现的位置 strings.Index(s,substr string) int</p></li>

<li><p>字串在字符串最后出现的位置 strings.LastIndex(s,substr string) int</p></li>

<li><p>分割字符串 strings.Split(s,sep string) []string</p></li>

<li><p>替换 strings.Replace(s,old,new string, n int) string  如果n&lt;0则表示全部替换</p></li>

<li><p>strings.ToLower</p></li>

<li><p>strings.TrimSpace,strings.Trim,strings.TrimLeft,strings.TrimRight</p></li>

<li><p>前缀后缀 strings.HasPrefix,strings.HasSuffix</p></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">MakeAddSuffix</span><span class="p">(</span><span class="nx">prefix</span> <span class="kt">string</span><span class="p">)</span> <span class="kd">func</span><span class="p">(</span><span class="kt">string</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">func</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">!</span><span class="nx">strings</span><span class="p">.</span><span class="nf">HasPrefix</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">prefix</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">prefix</span> <span class="o">+</span> <span class="nx">name</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">name</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<h3 id="时间"><strong>时间</strong></h3>

<ul>
<li><p>now := time.Now()</p></li>

<li><p>格式化时间函数Fomat  now.Format() !备注：2006-01-02 15:04:05 数字必须固定</p></li>

<li><p>获取当前时间戳 now.Unix(), now.UnixNano()</p></li>

<li><p>time.LoadLocation(name string)</p></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">var</span> <span class="nx">locales</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span>
<span class="kd">func</span> <span class="nf">date</span><span class="p">(</span><span class="nx">formate</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">t</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Time</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
    <span class="nx">year</span><span class="p">,</span> <span class="nx">month</span><span class="p">,</span> <span class="nx">day</span> <span class="o">:=</span> <span class="nx">t</span><span class="p">.</span><span class="nf">Date</span><span class="p">()</span>
    <span class="nx">hour</span><span class="p">,</span> <span class="nx">min</span><span class="p">,</span> <span class="nx">sec</span> <span class="o">:=</span> <span class="nx">t</span><span class="p">.</span><span class="nf">Clock</span><span class="p">()</span>
    <span class="nx">formate</span> <span class="p">=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Replace</span><span class="p">(</span><span class="nx">formate</span><span class="p">,</span> <span class="s">&#34;Y&#34;</span><span class="p">,</span> <span class="s">&#34;d&#34;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="nx">formate</span> <span class="p">=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Replace</span><span class="p">(</span><span class="nx">formate</span><span class="p">,</span> <span class="s">&#34;m&#34;</span><span class="p">,</span> <span class="s">&#34;d&#34;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="nx">formate</span> <span class="p">=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Replace</span><span class="p">(</span><span class="nx">formate</span><span class="p">,</span> <span class="s">&#34;d&#34;</span><span class="p">,</span> <span class="s">&#34;d&#34;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="nx">formate</span> <span class="p">=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Replace</span><span class="p">(</span><span class="nx">formate</span><span class="p">,</span> <span class="s">&#34;H&#34;</span><span class="p">,</span> <span class="s">&#34;d&#34;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="nx">formate</span> <span class="p">=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Replace</span><span class="p">(</span><span class="nx">formate</span><span class="p">,</span> <span class="s">&#34;M&#34;</span><span class="p">,</span> <span class="s">&#34;d&#34;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="nx">formate</span> <span class="p">=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Replace</span><span class="p">(</span><span class="nx">formate</span><span class="p">,</span> <span class="s">&#34;S&#34;</span><span class="p">,</span> <span class="s">&#34;d&#34;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="nx">formate</span><span class="p">,</span> <span class="nx">year</span><span class="p">,</span> <span class="nx">month</span><span class="p">,</span> <span class="nx">day</span><span class="p">,</span> <span class="nx">hour</span><span class="p">,</span> <span class="nx">min</span><span class="p">,</span> <span class="nx">sec</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">msg</span><span class="p">(</span><span class="nx">lang</span><span class="p">,</span> <span class="nx">key</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nx">v</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">locales</span><span class="p">[</span><span class="nx">lang</span><span class="p">];</span> <span class="nx">ok</span> <span class="p">{</span>
        <span class="k">if</span> <span class="nx">v2</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">v</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span> <span class="nx">ok</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">v2</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="s">&#34;&#34;</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="nx">locales</span> <span class="p">=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="nx">en</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="nx">cn</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="nx">en</span><span class="p">[</span><span class="s">&#34;time_zone&#34;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&#34;America/Chicago&#34;</span>
    <span class="nx">cn</span><span class="p">[</span><span class="s">&#34;time_zone&#34;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&#34;Asia/Shanghai&#34;</span>
    <span class="nx">locales</span><span class="p">[</span><span class="s">&#34;zh-CN&#34;</span><span class="p">]</span> <span class="p">=</span> <span class="nx">cn</span>
    <span class="nx">locales</span><span class="p">[</span><span class="s">&#34;en&#34;</span><span class="p">]</span> <span class="p">=</span> <span class="nx">en</span>
    <span class="nx">lang</span> <span class="o">:=</span> <span class="s">&#34;zh-CN&#34;</span>
    <span class="nx">loc</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">LoadLocation</span><span class="p">(</span><span class="nf">msg</span><span class="p">(</span><span class="nx">lang</span><span class="p">,</span> <span class="s">&#34;time_zone&#34;</span><span class="p">))</span>
    <span class="nx">t</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">()</span>
    <span class="nx">t</span> <span class="p">=</span> <span class="nx">t</span><span class="p">.</span><span class="nf">In</span><span class="p">(</span><span class="nx">loc</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nf">Format</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">RFC3339</span><span class="p">))</span> <span class="c1">// 2019-07-26T15:30:04+08:00
</span><span class="c1"></span>
    <span class="nx">en</span><span class="p">[</span><span class="s">&#34;date_format&#34;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&#34;%Y-%m-%d %H:%M:%S&#34;</span>
    <span class="nx">cn</span><span class="p">[</span><span class="s">&#34;date_format&#34;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&#34;%Y年%m月%d日 %H时%M分%S秒&#34;</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nf">date</span><span class="p">(</span><span class="nf">msg</span><span class="p">(</span><span class="nx">lang</span><span class="p">,</span> <span class="s">&#34;date_format&#34;</span><span class="p">),</span> <span class="nx">t</span><span class="p">))</span> <span class="c1">// 2019年7月26日 15时30分4秒
</span><span class="c1"></span>
    <span class="c1">// UTC时间戳默认+8个小时
</span><span class="c1"></span>    <span class="nx">tt</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="s">&#34;2006-01-02 15:04:05&#34;</span><span class="p">,</span> <span class="s">&#34;2019-08-01 00:00:00&#34;</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">tt</span><span class="p">.</span><span class="nf">Unix</span><span class="p">())</span> <span class="c1">// 1564617600 = 2019-08-01 08:00:00
</span><span class="c1"></span>
    <span class="nx">loc</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">LoadLocation</span><span class="p">(</span><span class="s">&#34;PRC&#34;</span><span class="p">)</span>
    <span class="nx">t</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">ParseInLocation</span><span class="p">(</span><span class="s">&#34;2006-01-02 15:04:05&#34;</span><span class="p">,</span> <span class="s">&#34;2019-08-01 00:00:00&#34;</span><span class="p">,</span> <span class="nx">loc</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nf">Unix</span><span class="p">())</span> <span class="c1">// 1564588800 = 2019-08-01 00:00:00
</span><span class="c1"></span><span class="p">}</span>

 </code></pre></td></tr></table>
</div>
</div>
<h3 id="命令行参数"><strong>命令行参数</strong></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// 一个 string 的切片
</span><span class="c1"></span><span class="nx">os</span><span class="p">.</span><span class="nx">Args</span><span class="p">[]</span>

<span class="c1">// flag 包用来解析命令行参数
</span><span class="c1">// main.exe -p 200 -u root
</span><span class="c1"></span>
<span class="kd">var</span> <span class="nx">user</span> <span class="kt">string</span>
<span class="kd">var</span> <span class="nx">port</span> <span class="kt">int</span>

<span class="nx">flag</span><span class="p">.</span><span class="nf">StringVar</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">,</span><span class="s">&#34;u&#34;</span><span class="p">,</span><span class="s">&#34;&#34;</span><span class="p">,</span><span class="s">&#34;用户名默认为空&#34;</span><span class="p">)</span>
<span class="nx">flag</span><span class="p">.</span><span class="nf">IntVar</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">port</span><span class="p">,</span><span class="s">&#34;p&#34;</span><span class="p">,</span><span class="mi">3306</span><span class="p">,</span><span class="s">&#34;端口默认3306&#34;</span><span class="p">)</span>
<span class="c1">//important!
</span><span class="c1"></span><span class="nx">flag</span><span class="p">.</span><span class="nf">Parse</span><span class="p">()</span>

 </code></pre></td></tr></table>
</div>
</div>
<h3 id="文件处理"><strong>文件处理</strong></h3>

<ul>
<li>读文件</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">os</span><span class="p">.</span><span class="nf">Open</span><span class="p">()</span>
<span class="nx">file</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
<span class="nx">bufio</span><span class="p">.</span><span class="nf">NewReader</span><span class="p">()</span>
<span class="nx">reader</span><span class="p">.</span><span class="nf">ReadString</span><span class="p">()</span>

<span class="c1">// 使用ioutil一次将整个文件读入到内存中
</span><span class="c1"></span><span class="nx">ioutil</span><span class="p">.</span><span class="nx">ReadFile</span>

 </code></pre></td></tr></table>
</div>
</div>
<ul>
<li>写文件</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">OpenFile</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">,</span><span class="nx">flag</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">perm</span> <span class="nx">FileMode</span><span class="p">)(</span><span class="nx">file</span> <span class="o">*</span><span class="nx">file</span><span class="p">,</span><span class="nx">err</span> <span class="kt">error</span><span class="p">)</span>

<span class="nx">ioutil</span><span class="p">.</span><span class="nf">WriteFile</span><span class="p">(</span><span class="nx">filePath</span><span class="p">,</span><span class="nx">data</span><span class="p">,</span><span class="nx">perm</span> <span class="nx">FileMode</span><span class="p">)</span>

 </code></pre></td></tr></table>
</div>
</div>
<ul>
<li>判断文件是否存在</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">os</span><span class="p">.</span><span class="nf">Stat</span><span class="p">()</span>
<span class="nx">os</span><span class="p">.</span><span class="nf">IsNotExist</span><span class="p">()</span>

 </code></pre></td></tr></table>
</div>
</div>
<ul>
<li>io.Copy(writer, reader)</li>
</ul>

<h2 id="函数">函数</h2>

<h3 id="func"><strong>func</strong></h3>

<ul>
<li><p>一个返回值为另一个函数的函数 称之为工厂函数</p></li>

<li><p>不支持嵌套，重载和默认参数</p></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// 一切皆类型
</span><span class="c1">// 匿名函数
</span><span class="c1"></span>
<span class="c1">// 1在定义匿名函数时直接调用，这种方式匿名函数只用调用一次
</span><span class="c1"></span><span class="nx">res1</span> <span class="o">:=</span> <span class="kd">func</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">a</span><span class="o">+</span><span class="nx">b</span>
<span class="p">}(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>

<span class="c1">// 2将匿名函数赋值给变量，res2的数据类型是函数类型
</span><span class="c1"></span><span class="nx">res2</span> <span class="o">:=</span> <span class="kd">func</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span><span class="p">{</span>
    <span class="k">return</span> <span class="nx">a</span><span class="o">+</span><span class="nx">b</span>
<span class="p">}</span>

<span class="c1">// 3全局匿名函数
</span><span class="c1"></span><span class="kd">var</span> <span class="p">(</span>
    <span class="nx">Fun1</span> <span class="p">=</span> <span class="kd">func</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span><span class="p">{</span>
        <span class="k">return</span> <span class="nx">a</span><span class="o">+</span><span class="nx">b</span>
    <span class="p">}</span>
<span class="p">)</span>


<span class="c1">// 闭包函数保存并积累其中的变量的值，不管外部函数退出与否，它都能够继续操作外部函数中的局部变量。
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">closure</span><span class="p">(</span><span class="nx">x</span> <span class="kt">int</span><span class="p">)</span> <span class="kd">func</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">func</span><span class="p">(</span><span class="nx">y</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">y</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">g</span> <span class="kt">int</span>
<span class="k">go</span> <span class="kd">func</span><span class="p">(</span><span class="nx">i</span> <span class="kt">int</span><span class="p">){</span>
    <span class="nx">s</span> <span class="o">:=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="nx">j</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span><span class="nx">j</span> <span class="p">&lt;</span> <span class="nx">i</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span> <span class="p">{</span>
        <span class="nx">s</span> <span class="o">+=</span> <span class="nx">j</span>
    <span class="p">}</span>
    <span class="nx">g</span> <span class="p">=</span> <span class="nx">s</span>
<span class="p">}(</span><span class="mi">1000</span><span class="p">)</span>

<span class="nb">println</span><span class="p">(</span><span class="nx">g</span><span class="p">)</span> <span class="c1">// 0
</span><span class="c1"></span>
 </code></pre></td></tr></table>
</div>
</div>
<h3 id="defer"><strong>defer</strong></h3>

<ul>
<li><p>在函数体执行结束后按照调用顺序的相反顺序逐个执行，先进后出，后进先出</p></li>

<li><p>类似于finally语句块，当函数执行完，可以及时释放某些已分配的资源（最主要的价值）</p></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">test</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">file</span> <span class="p">=</span> <span class="nf">openfile</span><span class="p">(</span><span class="nx">filename</span><span class="p">)</span>
    <span class="k">defer</span> <span class="nx">file</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="nf">test</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">conn</span> <span class="p">=</span> <span class="nf">openDatabase</span><span class="p">()</span>
    <span class="k">defer</span> <span class="nx">conn</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
<span class="p">}</span>

 </code></pre></td></tr></table>
</div>
</div>
<ul>
<li><p>即使发生严重错误也会执行</p></li>

<li><p>go没有异常机制，但有panic/recover模式来处理错误，panic可以在任何地方引发，但reciver只有在defer调用的函数中有效</p></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="nf">A</span><span class="p">()</span>
    <span class="nf">B</span><span class="p">()</span>
    <span class="nf">C</span><span class="p">()</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="nf">A</span><span class="p">(){</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;func A&#34;</span><span class="p">)</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="nf">B</span><span class="p">(){</span>
<span class="k">defer</span> <span class="kd">func</span><span class="p">(){</span>
      <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nb">recover</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
          <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;recover in B&#34;</span><span class="p">)</span>
      <span class="p">}</span>
<span class="p">}</span>
    <span class="nb">panic</span><span class="p">(</span><span class="s">&#34;Panic in B&#34;</span><span class="p">)</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="nf">C</span><span class="p">(){</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;func C&#34;</span><span class="p">)</span>
<span class="p">}</span>

<span class="nx">输出</span><span class="err">：</span>
<span class="kd">func</span> <span class="nx">A</span>
<span class="nx">recover</span> <span class="nx">in</span> <span class="nx">B</span>
<span class="kd">func</span> <span class="nx">C</span>

 </code></pre></td></tr></table>
</div>
</div>
<ul>
<li>闭包调试</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">where</span> <span class="o">:=</span> <span class="kd">func</span><span class="p">(){</span>
    <span class="nx">_</span><span class="p">,</span><span class="nx">file</span><span class="p">,</span><span class="nx">line</span><span class="p">,</span><span class="nx">_</span> <span class="o">:=</span> <span class="nx">runtime</span><span class="p">.</span><span class="nf">Caller</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="nx">log</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;%s:%d&#34;</span><span class="p">,</span><span class="nx">file</span><span class="p">,</span><span class="nx">line</span><span class="p">)</span>
<span class="p">}</span>

<span class="nf">where</span><span class="p">()</span>

<span class="err">#</span> <span class="mi">2</span>
<span class="nx">log</span><span class="p">.</span><span class="nf">SetFlags</span><span class="p">(</span><span class="nx">log</span><span class="p">.</span><span class="nx">Llongfile</span><span class="p">)</span>

<span class="kd">var</span> <span class="nx">where</span> <span class="p">=</span> <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span>

<span class="kd">func</span> <span class="nf">func1</span><span class="p">(){</span>
    <span class="nf">where</span><span class="p">()</span>
<span class="p">}</span>

 </code></pre></td></tr></table>
</div>
</div>
<h2 id="oop">OOP</h2>

<h3 id="方法"><strong>方法</strong></h3>

<ul>
<li><p>是指 作用在指定数据类型上的(即:和指定的数据类型绑定)，因此自定义类型都可以有<strong>方法</strong></p>

<ul>
<li>Method和结构体的结合</li>
</ul></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">A</span> <span class="kd">struct</span><span class="p">{</span>
    <span class="nx">Name</span> <span class="kt">string</span>
<span class="p">}</span>
<span class="kd">type</span> <span class="nx">B</span> <span class="kd">struct</span><span class="p">{}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="nx">a</span> <span class="o">:=</span> <span class="nx">A</span><span class="p">{}</span>
    <span class="nx">a</span><span class="p">.</span><span class="nf">Print</span><span class="p">()</span>
<span class="p">}</span>
<span class="c1">// Reciver 可以是值类型／指针
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">a</span> <span class="nx">A</span><span class="p">)</span> <span class="nf">Print</span><span class="p">(){</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;A&#34;</span><span class="p">)</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">a</span> <span class="o">*</span><span class="nx">A</span><span class="p">)</span> <span class="nf">Print</span><span class="p">(){</span>
  <span class="nx">a</span><span class="p">.</span><span class="nx">Name</span> <span class="p">=</span> <span class="s">&#34;AA&#34;</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;A&#34;</span><span class="p">)</span>
<span class="p">}</span>

 </code></pre></td></tr></table>
</div>
</div>
<ul>
<li>Method Value 和 Method Expression</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">TZ</span> <span class="kt">int</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">func_a</span> <span class="o">*</span><span class="nx">TZ</span><span class="p">)</span> <span class="nf">Print</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;OK&#34;</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">method_a</span> <span class="nx">TZ</span>
<span class="nx">method_a</span><span class="p">.</span><span class="nf">Print</span><span class="p">()</span> <span class="c1">// Method Value
</span><span class="c1"></span><span class="p">(</span><span class="o">*</span><span class="nx">TZ</span><span class="p">).</span><span class="nf">Print</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">method_a</span><span class="p">)</span> <span class="c1">// Method Expression
</span><span class="c1"></span>
<span class="c1">// method value 会复制 receiver。
</span><span class="c1"></span>
 </code></pre></td></tr></table>
</div>
</div>
<h3 id="接口"><strong>接口</strong></h3>

<ul>
<li>Structural Typing</li>
<li>interface类型默认是一个指针(引用类型)</li>
<li>不能包含任何变量</li>
<li>可以匿名嵌入其他接口和结构体</li>
<li>空接口可以作为任何类型数据的容器</li>
<li>只有当接口存储的类型和对象都为nil时，接口才等于nil</li>
<li>接口里的所有方法都没有方法体</li>
<li>接口不需要显示的实现</li>
<li>一个自定义类型需要将接口中的所有方法都实现</li>
<li>一个自定义类型可以实现多个接口</li>
<li>可以把任何一个变量赋给空接口</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">USB</span> <span class="kd">interface</span><span class="p">{</span>
    <span class="nf">Name</span><span class="p">()</span> <span class="kt">string</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">Connecter</span> <span class="kd">interface</span><span class="p">{</span>
    <span class="nf">Connect</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">PhoneConnecter</span> <span class="kd">struct</span><span class="p">{</span>
    <span class="nx">name</span> <span class="kt">string</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">pc</span> <span class="nx">PhoneConnecter</span><span class="p">)</span> <span class="nf">Name</span><span class="p">()</span> <span class="kt">string</span><span class="p">{</span>
    <span class="k">return</span> <span class="nx">pc</span><span class="p">.</span><span class="nx">name</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">pc</span> <span class="nx">PhoneConnecter</span><span class="p">)</span> <span class="nf">Connect</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Connected:&#34;</span><span class="p">,</span><span class="nx">pc</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">Disconnect</span><span class="p">(</span><span class="nx">usb</span> <span class="kd">interface</span><span class="p">{}){</span>
    <span class="k">switch</span> <span class="nx">v</span><span class="o">:=</span> <span class="nx">usb</span><span class="p">.(</span><span class="kd">type</span><span class="p">){</span>
        <span class="k">case</span> <span class="nx">PhoneConnecter</span><span class="p">:</span>
          <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Disconnected:&#34;</span><span class="p">,</span><span class="nx">v</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span>
        <span class="k">default</span><span class="p">:</span>
          <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Unknow decive&#34;</span><span class="p">)</span>
    <span class="p">}</span>

<span class="p">}</span>



<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">interface_a</span> <span class="o">:=</span> <span class="nx">PhoneConnecter</span><span class="p">{</span><span class="s">&#34;HUAWEI&#34;</span><span class="p">}</span>
    <span class="nx">interface_a</span><span class="p">.</span><span class="nf">Connect</span><span class="p">()</span>
    <span class="nf">Discount</span><span class="p">(</span><span class="nx">interface_a</span><span class="p">)</span>

    <span class="kd">var</span> <span class="nx">n</span> <span class="kt">float64</span> <span class="p">=</span> <span class="mf">8.8</span>
    <span class="kd">var</span> <span class="nx">a</span> <span class="kd">interface</span><span class="p">{}</span> <span class="p">=</span> <span class="nx">n</span>

    <span class="c1">// 对象的只读复制品，复制完整对象或指针。
</span><span class="c1"></span>    <span class="kd">type</span> <span class="nx">User</span> <span class="kd">struct</span> <span class="p">{</span>
        <span class="nx">id</span>   <span class="kt">int</span>
        <span class="nx">name</span> <span class="kt">string</span>
    <span class="p">}</span>
    <span class="nx">u</span> <span class="o">:=</span> <span class="nx">User</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#34;tom&#34;</span><span class="p">}</span>
    <span class="kd">var</span> <span class="nx">i</span> <span class="kd">interface</span><span class="p">{}</span> <span class="p">=</span> <span class="nx">u</span>

    <span class="nx">u</span><span class="p">.</span><span class="nx">id</span> <span class="p">=</span> <span class="mi">2</span>
    <span class="nx">u</span><span class="p">.</span><span class="nx">name</span> <span class="p">=</span> <span class="s">&#34;jack&#34;</span>

    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;%v&#34;</span><span class="p">,</span> <span class="nx">u</span><span class="p">)</span>        <span class="c1">// {2,jack}
</span><span class="c1"></span>    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;%v&#34;</span><span class="p">,</span> <span class="nx">i</span><span class="p">.(</span><span class="nx">User</span><span class="p">))</span> <span class="c1">// {1,tom}
</span><span class="c1"></span>

<span class="p">}</span>

 </code></pre></td></tr></table>
</div>
</div>
<h3 id="类似封装-继承-多态的特性"><strong>类似封装，继承，多态的特性</strong></h3>

<ul>
<li><p>对结构体中的属性进行封装</p></li>

<li><p>通过方法，包 实现封装</p></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">Student</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">Name</span>  <span class="kt">string</span>
    <span class="nx">score</span> <span class="kt">float64</span>
<span class="p">}</span>

<span class="c1">// 一个工厂模式的函数，相当于构造函数
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">NewStudent</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">)</span> <span class="o">*</span><span class="nx">Student</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&amp;</span><span class="nx">Student</span><span class="p">{</span>
        <span class="nx">Name</span><span class="p">:</span> <span class="nx">name</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">stu</span> <span class="o">*</span><span class="nx">Student</span><span class="p">)</span> <span class="nf">GetScore</span><span class="p">()</span> <span class="kt">float64</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">stu</span><span class="p">.</span><span class="nx">score</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">stu</span> <span class="o">*</span><span class="nx">Student</span><span class="p">)</span> <span class="nf">SetScore</span><span class="p">(</span><span class="nx">score</span> <span class="kt">float64</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">stu</span><span class="p">.</span><span class="nx">score</span> <span class="p">=</span> <span class="nx">score</span>
<span class="p">}</span>

 </code></pre></td></tr></table>
</div>
</div>
<ul>
<li>继承可以解决代码复用</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">Human</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">Sex</span> <span class="kt">int</span>
<span class="p">}</span>
<span class="kd">type</span> <span class="nx">techer</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">Human</span>
    <span class="nx">Name</span> <span class="kt">string</span>
    <span class="nx">Age</span> <span class="kt">int</span>
<span class="p">}</span>
<span class="kd">type</span> <span class="nx">student</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">Human</span>
    <span class="nx">Name</span> <span class="kt">string</span>
    <span class="nx">Age</span> <span class="kt">int</span>
<span class="p">}</span>

 </code></pre></td></tr></table>
</div>
</div>
<ul>
<li>当结构体和匿名结构体有相同的字段和方法时，编译器采用就近原则。希望访问
匿名结构体的字段和方法，可以通过匿名结构体名来区分。</li>

<li><p>结构体嵌入两个(或多个)匿名结构体，如两个匿名结构体有相同的字段和方法(同时结构体本身
没有同名的字段和方法)，在访问时，就必须明确指定匿名结构体名字</p></li>

<li><p>多态特征是通过接口实现的</p></li>

<li><p>多态数组</p></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">USB</span> <span class="kd">interface</span><span class="p">{</span>
  <span class="nf">Start</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">Phone</span> <span class="kd">struct</span><span class="p">{}</span>

<span class="kd">type</span> <span class="nx">Camera</span> <span class="kd">struct</span><span class="p">{}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">ph</span> <span class="nx">Phone</span><span class="p">)</span> <span class="nf">Start</span><span class="p">(){</span>
  <span class="o">...</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="nx">Camera</span><span class="p">)</span> <span class="nf">Start</span><span class="p">(){</span>
  <span class="o">...</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="c1">//定义一个 Usb 接口数组，可以存放 Phone 和 Camera 的结构体变量
</span><span class="c1"></span>    <span class="kd">var</span> <span class="nx">usbArr</span> <span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="nx">USB</span> <span class="c1">//多态数组
</span><span class="c1"></span>    <span class="nx">usbArr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">=</span> <span class="nx">Phone</span><span class="p">{}</span>
    <span class="nx">usbArr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">=</span> <span class="nx">Phone</span><span class="p">{}</span>
    <span class="nx">usbArr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">=</span> <span class="nx">Camera</span><span class="p">{}</span>
<span class="p">}</span>

 </code></pre></td></tr></table>
</div>
</div>
<h2 id="协程-管道-select">协程，管道，Select</h2>

<h3 id="goroutine"><strong>goroutine</strong></h3>

<ul>
<li><p>go协程的特点</p>

<ul>
<li>有独立的栈空间</li>
<li>共享程序的堆空间</li>
<li>调度由用户控制</li>
<li>协程是轻量级的线程，是逻辑态</li>
<li>如果主线程结束了，即使协程还未执行完也会退出</li>
</ul></li>

<li><p>goroutine的调度模型</p>

<ul>
<li>MPG模式  M：物理线程，P：协程执行需要的上下文 G：协程</li>
</ul></li>

<li><p>runtime.GOMAXPROCS(runtime.NumCPU())</p></li>

<li><p>goroutine通过channel来共享内存</p></li>

<li><p>goroutine会有资源争夺的问题</p></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">//如 concurrent map writes!
</span><span class="c1"></span>
<span class="nx">解决方案</span><span class="err">：</span>
<span class="mi">1</span> <span class="nx">全局变量的互斥锁</span>
<span class="kd">var</span> <span class="p">(</span>
    <span class="nx">lock</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span>
<span class="p">)</span>
<span class="nx">lock</span><span class="p">.</span><span class="nf">Lock</span><span class="p">()</span>
<span class="o">...</span>
<span class="nx">lock</span><span class="p">.</span><span class="nf">Unlock</span><span class="p">()</span>

<span class="mi">2</span> <span class="nx">使用管道</span> <span class="nx">channel</span> <span class="nx">来解决</span>

 </code></pre></td></tr></table>
</div>
</div>
<ul>
<li>sync</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">sum</span><span class="p">(</span><span class="nx">id</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">x</span> <span class="kt">int64</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">math</span><span class="p">.</span><span class="nx">MaxUint32</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="nx">x</span> <span class="o">+=</span> <span class="nb">int64</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nb">println</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">x</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="nx">wg</span><span class="o">:=</span><span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span><span class="p">{}</span>
    <span class="nx">wg</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">for</span> <span class="nx">i</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="p">&lt;</span><span class="mi">3</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">{</span>
        <span class="k">go</span> <span class="kd">func</span><span class="p">(</span><span class="nx">id</span> <span class="kt">int</span><span class="p">){</span>
            <span class="k">defer</span> <span class="nx">wg</span><span class="p">.</span><span class="nf">Done</span><span class="p">()</span>
            <span class="nf">sum</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span>
        <span class="p">}(</span><span class="nx">i</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nx">wg</span><span class="p">.</span><span class="nf">Wait</span><span class="p">()</span>
<span class="p">}</span>

 </code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">//线程安全的方式创建一些东西的最好选择是 sync.Once
</span><span class="c1"></span><span class="kd">var</span> <span class="nx">once</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">Once</span>
<span class="nx">onceBody</span> <span class="o">:=</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Only once&#34;</span><span class="p">)</span>
<span class="p">}</span>
<span class="nx">done</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">bool</span><span class="p">)</span>
<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
    <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">once</span><span class="p">.</span><span class="nf">Do</span><span class="p">(</span><span class="nx">onceBody</span><span class="p">)</span>
        <span class="nx">done</span> <span class="o">&lt;-</span> <span class="kc">true</span>
    <span class="p">}()</span>
<span class="p">}</span>
<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
    <span class="o">&lt;-</span><span class="nx">done</span>
<span class="p">}</span>

 </code></pre></td></tr></table>
</div>
</div>
<h3 id="管道channel-引用类型"><strong>管道channel(引用类型)</strong></h3>

<ul>
<li><p><strong>必须初始化才能写入数据</strong></p></li>

<li><p>本质是一个数据结构：队列</p></li>

<li><p>先进先出</p></li>

<li><p>线程安全</p></li>

<li><p>channel有类型，一个string的channel只能放string类型的数据</p></li>

<li><p>定义／声明</p></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">var</span> <span class="nx">变量名</span> <span class="kd">chan</span> <span class="nx">数据类型</span>
<span class="nx">channel存放满了就不能继续放入</span><span class="err">，</span><span class="nx">取完以后不能继续取值</span>

<span class="kd">var</span> <span class="nx">allchan</span> <span class="kd">chan</span> <span class="kd">interface</span><span class="p">{}</span>
<span class="kd">var</span> <span class="nx">mapchan</span> <span class="kd">chan</span> <span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="kt">int</span>
<span class="kd">var</span> <span class="nx">catchan</span> <span class="kd">chan</span> <span class="nx">Cat</span>
<span class="kd">var</span> <span class="nx">catchan</span> <span class="kd">chan</span> <span class="o">*</span><span class="nx">Cat</span>

<span class="kd">chan</span><span class="o">&lt;-</span> <span class="c1">// 写
</span><span class="c1"></span><span class="o">&lt;-</span><span class="kd">chan</span> <span class="c1">// 读
</span><span class="c1"></span>

<span class="c1">//循环channel
</span><span class="c1">//必须要close
</span><span class="c1"></span><span class="nx">c</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">bool</span><span class="p">)</span>
<span class="k">go</span> <span class="kd">func</span><span class="p">(){</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;GOGOGO&#34;</span><span class="p">)</span>
        <span class="nx">c</span> <span class="o">&lt;-</span> <span class="kc">true</span>
        <span class="nb">close</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span>
<span class="p">}()</span>
<span class="k">for</span> <span class="nx">v</span> <span class="o">:=</span><span class="k">range</span> <span class="nx">c</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span>
<span class="p">}</span>

 </code></pre></td></tr></table>
</div>
</div>
<ul>
<li><p>channel是goroutine沟通的桥梁，默认是同步阻塞，读和取需要同步</p></li>

<li><p>异步方式是通过判断缓冲区来决定是否阻塞。如果缓冲区已满，发送被阻塞。缓冲区为空，接受被阻塞</p></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">//有缓存和无缓存的差别
</span><span class="c1"></span><span class="nx">chan_c</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">int</span><span class="p">)</span>
<span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;GOGOGO!!!&#34;</span><span class="p">)</span>
    <span class="o">&lt;-</span><span class="nx">chan_c</span>
<span class="p">}()</span>
<span class="nx">chan_c</span> <span class="o">&lt;-</span> <span class="mi">1</span>
<span class="c1">// 有缓存是异步的
</span><span class="c1"></span><span class="nx">chan_b</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">int</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="c1">//缓冲区可以存储 2 个元素
</span><span class="c1"></span><span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;GOGOGO!!!&#34;</span><span class="p">)</span>
    <span class="nx">chan_b</span> <span class="o">&lt;-</span> <span class="mi">1</span>
<span class="p">}()</span>
<span class="o">&lt;-</span><span class="nx">chan_b</span>

<span class="c1">// 除了用range还可以用ok-idiom模式判断channel是否关闭
</span><span class="c1"></span><span class="k">for</span><span class="p">{</span>
    <span class="k">if</span> <span class="nx">d</span><span class="p">,</span><span class="nx">ok</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="nx">data</span><span class="p">;</span> <span class="nx">ok</span><span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nf">Print</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="k">break</span>
    <span class="p">}</span>
<span class="p">}</span>

 </code></pre></td></tr></table>
</div>
</div>
<ul>
<li>可设置单向或者双向通道</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">var</span> <span class="kd">chan</span> <span class="kd">chan</span><span class="o">&lt;-</span> <span class="kt">int</span> <span class="c1">// 只能写
</span><span class="c1"></span><span class="kd">var</span> <span class="kd">chan</span> <span class="o">&lt;-</span><span class="kd">chan</span> <span class="kt">int</span> <span class="c1">// 只能读
</span><span class="c1"></span>
 </code></pre></td></tr></table>
</div>
</div>
<ul>
<li><p>关闭channel：close(channel)  可以继续从关闭的channel中执行读取操作</p></li>

<li><p>一个非空的通道也是可以关闭的， 但是通道中剩下的值仍然可以被接收到。</p></li>

<li><p>支持ok写法：这个OK代表有新的数据写入或者是关闭的channel</p></li>
</ul>

<h3 id="select"><strong>Select</strong></h3>

<ul>
<li><p>使用 select 可以解决从管道取数据的阻塞问题</p></li>

<li><p>select处理一个或多个channel的发送和接收</p></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">c1</span><span class="p">,</span><span class="nx">c2</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">int</span><span class="p">),</span><span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">string</span><span class="p">)</span>
<span class="nx">o</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">bool</span><span class="p">)</span>
<span class="k">go</span> <span class="kd">func</span><span class="p">(){</span>
    <span class="k">for</span><span class="p">{</span>
        <span class="k">select</span><span class="p">{</span>
        <span class="k">case</span> <span class="nx">v</span><span class="p">,</span><span class="nx">ok</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="nx">c1</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">!</span><span class="nx">ok</span> <span class="p">{</span>
                <span class="nx">o</span> <span class="o">&lt;-</span> <span class="kc">true</span>
                <span class="k">break</span>
            <span class="p">}</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;c1&#34;</span><span class="p">,</span><span class="nx">v</span><span class="p">)</span>
        <span class="k">case</span> <span class="nx">v</span><span class="p">,</span><span class="nx">ok</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="nx">c2</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">!</span><span class="nx">ok</span> <span class="p">{</span>
                <span class="nx">o</span> <span class="o">&lt;-</span> <span class="kc">true</span>
                <span class="k">break</span>
            <span class="p">}</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;c2&#34;</span><span class="p">,</span><span class="nx">v</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}()</span>
<span class="nx">c1</span><span class="o">&lt;-</span><span class="mi">1</span>
<span class="nx">c2</span><span class="o">&lt;-</span><span class="s">&#34;hi&#34;</span>
<span class="nb">close</span><span class="p">(</span><span class="nx">c1</span><span class="p">)</span>
<span class="nb">close</span><span class="p">(</span><span class="nx">c2</span><span class="p">)</span>
<span class="o">&lt;-</span><span class="nx">o</span>


<span class="c1">// 设置超时 timeout
</span><span class="c1"></span><span class="nx">w</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">bool</span><span class="p">)</span>
<span class="nx">c</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">int</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">select</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nx">v</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="nx">c</span><span class="p">:</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span>
    <span class="k">case</span> <span class="o">&lt;-</span><span class="nx">time</span><span class="p">.</span><span class="nf">After</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span> <span class="o">*</span> <span class="mi">3</span><span class="p">):</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;timeout.&#34;</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nx">w</span> <span class="o">&lt;-</span> <span class="kc">true</span>
<span class="p">}()</span>
<span class="c1">// c &lt;- 1 // 注释掉会引发超时
</span><span class="c1"></span><span class="o">&lt;-</span><span class="nx">w</span>

 </code></pre></td></tr></table>
</div>
</div>
<ul>
<li><p>同时有多个可用的channel时按随机顺序处理</p></li>

<li><p>在goroutine中使用recover，解决协程中出现的panic，导程序奔溃</p></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">test</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">defer</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nb">recover</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nf">Print</span><span class="p">(</span><span class="s">&#34;panic!!!,recover&#34;</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}()</span>
    <span class="nb">panic</span><span class="p">(</span><span class="s">&#34;...&#34;</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="k">go</span> <span class="nf">test</span><span class="p">()</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;main() ok=&#34;</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span>
        <span class="nx">time</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

 </code></pre></td></tr></table>
</div>
</div>
<h3 id="定时器和打点器"><strong>定时器和打点器</strong></h3>

<ul>
<li><p>定时器表示在未来某一时刻的独立事件。你告诉定时器需要等待的时间，然后它将提供一个用于通知的通道。</p></li>

<li><p>如果仅仅是单纯的等待，你需要使用 <code>time.Sleep</code>。 定时器有用原因之一就是你可以在定时器失效之前，取消这个定时器。</p></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">timer2</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">NewTimer</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
<span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
    <span class="o">&lt;-</span><span class="nx">timer2</span><span class="p">.</span><span class="nx">C</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Timer 2 expired&#34;</span><span class="p">)</span>
<span class="p">}()</span>
<span class="nx">stop2</span> <span class="o">:=</span> <span class="nx">timer2</span><span class="p">.</span><span class="nf">Stop</span><span class="p">()</span>
<span class="k">if</span> <span class="nx">stop2</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Timer 2 stopped&#34;</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// func (*Timer) Reset
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">Timer</span><span class="p">)</span> <span class="nf">Reset</span><span class="p">(</span><span class="nx">d</span> <span class="nx">Duration</span><span class="p">)</span> <span class="kt">bool</span>
<span class="c1">//Reset 使 t 重新开始计时，（本方法返回后再）等待时间段 d 过去后到期。如果调用时 t 还在等待中会返回真；如果 t 已经到期或者被停止了会返回假。
</span><span class="c1"></span>
<span class="nx">wait</span> <span class="o">:=</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span><span class="p">{}</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;start&#34;</span><span class="p">,</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">())</span>
<span class="nx">wait</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nx">timer</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">NewTimer</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
<span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
    <span class="o">&lt;-</span><span class="nx">timer</span><span class="p">.</span><span class="nx">C</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;get timer&#34;</span><span class="p">,</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">())</span>
    <span class="nx">wait</span><span class="p">.</span><span class="nf">Done</span><span class="p">()</span>
<span class="p">}()</span>
<span class="nx">time</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;sleep&#34;</span><span class="p">,</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">())</span>
<span class="nx">timer</span><span class="p">.</span><span class="nf">Reset</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
<span class="nx">wait</span><span class="p">.</span><span class="nf">Wait</span><span class="p">()</span>
<span class="c1">// 输出:
</span><span class="c1">// start 2018-06-04 13:07:51.780367114 +0800 CST m=+0.000324036
</span><span class="c1">// sleep 2018-06-04 13:07:52.783389811 +0800 CST m=+1.003316644
</span><span class="c1">// get timer 2018-06-04 13:07:55.784534298 +0800 CST m=+4.004371103
</span><span class="c1"></span>
 </code></pre></td></tr></table>
</div>
</div>
<ul>
<li>打点器：想要在固定的时间间隔重复执行。打点器可以和定时器一样被停止</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">Ticker</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">C</span> <span class="o">&lt;-</span><span class="kd">chan</span> <span class="nx">Time</span> <span class="c1">// 周期性传递时间信息的通道
</span><span class="c1"></span>    <span class="c1">// 内含隐藏或非导出字段
</span><span class="c1"></span><span class="p">}</span>
  <span class="c1">// Ticker 保管一个通道，并每隔一段时间向其传递”tick”。
</span><span class="c1"></span>
 </code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">ticker</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">NewTicker</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Millisecond</span> <span class="o">*</span> <span class="mi">500</span><span class="p">)</span>
<span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">for</span> <span class="nx">t</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">ticker</span><span class="p">.</span><span class="nx">C</span> <span class="p">{</span>
      <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Tick at&#34;</span><span class="p">,</span> <span class="nx">t</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}()</span>
<span class="nx">time</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Millisecond</span> <span class="o">*</span> <span class="mi">1600</span><span class="p">)</span>
<span class="nx">ticker</span><span class="p">.</span><span class="nf">Stop</span><span class="p">()</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Ticker stopped&#34;</span><span class="p">)</span>

<span class="kd">func</span> <span class="nf">Tick</span><span class="p">(</span><span class="nx">d</span> <span class="nx">Duration</span><span class="p">)</span> <span class="o">&lt;-</span><span class="kd">chan</span> <span class="nx">Time</span>
<span class="c1">//Tick 是 NewTicker 的封装，只提供对 Ticker 的通道的访问。如果不需要关闭 Ticker，本函数就很方便。
</span><span class="c1"></span>
<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;start&#34;</span><span class="p">,</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">())</span>
<span class="nx">count</span> <span class="o">:=</span> <span class="mi">0</span>
<span class="nx">wait</span> <span class="o">:=</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span><span class="p">{}</span>
<span class="nx">wait</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nx">ticker</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Tick</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
<span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">for</span> <span class="nx">tick</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">ticker</span> <span class="p">{</span>
      <span class="nx">count</span> <span class="o">+=</span> <span class="mi">1</span>
      <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;tick at&#34;</span><span class="p">,</span> <span class="nx">tick</span><span class="p">)</span>
      <span class="k">if</span> <span class="nx">count</span> <span class="o">&gt;=</span> <span class="mi">5</span> <span class="p">{</span>
          <span class="nx">wait</span><span class="p">.</span><span class="nf">Done</span><span class="p">()</span>
          <span class="k">break</span>
      <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}()</span>
<span class="nx">wait</span><span class="p">.</span><span class="nf">Wait</span><span class="p">()</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;stoped&#34;</span><span class="p">,</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">())</span>

 </code></pre></td></tr></table>
</div>
</div>
<h2 id="其他">其他</h2>

<h3 id="反射reflection"><strong>反射Reflection</strong></h3>

<ul>
<li>reflect.TypeOf()</li>
<li>reflect.ValueOf()</li>
<li>reflect.ValueOf().Kind() // 类别，是一个常量</li>
<li>Elem()</li>
<li>反射可以 让 变量，interface{},reflect.Value 互相转换</li>
<li>应用：

<ul>
<li>对结构体字段的反射</li>
<li>函数的适配器</li>
</ul></li>
</ul>

<h3 id="redis"><strong>Redis</strong></h3>

<ul>
<li><p>go get <a href="https://gowalker.org/github.com/gomodule/redigo/redis">github.com/gomodule/redigo/redis</a></p></li>

<li><p>String hash list set zset</p></li>

<li><p>操作方法</p></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">conn</span><span class="p">,</span><span class="nx">err</span> <span class="o">:=</span> <span class="nx">redis</span><span class="p">.</span><span class="nf">Dail</span><span class="p">(</span><span class="s">&#34;tcp&#34;</span><span class="p">,</span><span class="s">&#34;127.0.0.1:6379&#34;</span><span class="p">)</span>
<span class="k">defer</span> <span class="nx">conn</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
<span class="c1">//string
</span><span class="c1"></span><span class="nx">set</span><span class="o">/</span><span class="nx">get</span>
<span class="nx">setex</span>
<span class="c1">//hash
</span><span class="c1"></span><span class="nx">hset</span><span class="o">/</span><span class="nx">hget</span><span class="o">/</span><span class="nx">hgetall</span><span class="o">/</span><span class="nx">hdel</span>
<span class="c1">//list
</span><span class="c1"></span><span class="nx">lpush</span><span class="o">/</span><span class="nx">rpush</span><span class="o">/</span><span class="nx">lrange</span><span class="o">/</span><span class="nx">lpop</span><span class="o">/</span><span class="nx">rpop</span><span class="o">/</span><span class="nx">del</span>
<span class="c1">//set
</span><span class="c1"></span><span class="nx">sadd</span><span class="o">/</span><span class="nx">smembers</span><span class="o">/</span><span class="nx">srem</span>

<span class="nx">_</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">conn</span><span class="p">.</span><span class="nf">Do</span><span class="p">(</span><span class="s">&#34;expire&#34;</span><span class="p">,</span> <span class="s">&#34;name&#34;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

<span class="nx">_</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">conn</span><span class="p">.</span><span class="nf">Do</span><span class="p">(</span><span class="s">&#34;HSet&#34;</span><span class="p">,</span> <span class="s">&#34;user01&#34;</span><span class="p">,</span> <span class="s">&#34;name&#34;</span><span class="p">,</span> <span class="s">&#34;leighj&#34;</span><span class="p">)</span>
<span class="c1">// 因为返回 r 是 interface{} 需要转换
</span><span class="c1"></span><span class="nx">r</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">redis</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="nx">conn</span><span class="p">.</span><span class="nf">Do</span><span class="p">(</span><span class="s">&#34;HGet&#34;</span><span class="p">,</span> <span class="s">&#34;user01&#34;</span><span class="p">,</span> <span class="s">&#34;name&#34;</span><span class="p">))</span>
<span class="nx">_</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">conn</span><span class="p">.</span><span class="nf">Do</span><span class="p">(</span><span class="s">&#34;HSet&#34;</span><span class="p">,</span> <span class="s">&#34;user01&#34;</span><span class="p">,</span> <span class="s">&#34;age&#34;</span><span class="p">,</span> <span class="mi">18</span><span class="p">)</span>
<span class="c1">// 因为返回 r 是 interface{} 需要转换
</span><span class="c1"></span><span class="nx">i</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">redis</span><span class="p">.</span><span class="nf">Int</span><span class="p">(</span><span class="nx">conn</span><span class="p">.</span><span class="nf">Do</span><span class="p">(</span><span class="s">&#34;HGet&#34;</span><span class="p">,</span> <span class="s">&#34;user01&#34;</span><span class="p">,</span> <span class="s">&#34;age&#34;</span><span class="p">))</span>
<span class="c1">//list
</span><span class="c1"></span><span class="nx">_</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">conn</span><span class="p">.</span><span class="nf">Do</span><span class="p">(</span><span class="s">&#34;lpush&#34;</span><span class="p">,</span> <span class="s">&#34;heroList&#34;</span><span class="p">,</span> <span class="s">&#34;no1:宋江&#34;</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="s">&#34;no2:卢俊义&#34;</span><span class="p">,</span> <span class="mi">28</span><span class="p">)</span>
<span class="c1">// 因为返回 r 是 interface{} 需要转换
</span><span class="c1"></span><span class="nx">r</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">redis</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="nx">conn</span><span class="p">.</span><span class="nf">Do</span><span class="p">(</span><span class="s">&#34;rpop&#34;</span><span class="p">,</span> <span class="s">&#34;heroList&#34;</span><span class="p">))</span>

 </code></pre></td></tr></table>
</div>
</div>
<ul>
<li>连接池</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">var</span> <span class="nx">pool</span> <span class="o">*</span><span class="nx">redis</span><span class="p">.</span><span class="nx">Pool</span>
<span class="kd">func</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">pool</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">redis</span><span class="p">.</span><span class="nx">Pool</span><span class="p">{</span>
        <span class="nx">MaxIdle</span><span class="p">:</span>   <span class="mi">8</span><span class="p">,</span> <span class="c1">//最大空闲链接数
</span><span class="c1"></span>        <span class="nx">MaxActive</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="c1">//表示和数据库的最大链接数， 0 表示没有限制
</span><span class="c1"></span>        <span class="nx">IdleTimeout</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="c1">// 最大空闲时间
</span><span class="c1"></span>        <span class="nx">Dial</span><span class="p">:</span> <span class="kd">func</span><span class="p">()</span> <span class="p">(</span><span class="nx">redis</span><span class="p">.</span><span class="nx">Conn</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// 初始化链接的代码， 链接哪个 ip 的 redis
</span><span class="c1"></span>        <span class="k">return</span> <span class="nx">redis</span><span class="p">.</span><span class="nf">Dial</span><span class="p">(</span><span class="s">&#34;tcp&#34;</span><span class="p">,</span> <span class="s">&#34;127.0.0.1:6379&#34;</span><span class="p">)</span>
        <span class="p">},</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="nx">conn</span> <span class="o">:=</span> <span class="nx">poll</span><span class="p">.</span><span class="nf">Get</span><span class="p">()</span>
    <span class="k">defer</span> <span class="nx">conn</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
    <span class="o">...</span>
<span class="p">}</span>

 </code></pre></td></tr></table>
</div>
</div>
<h3 id="正则"><strong>正则</strong></h3>

<p>regex.MustCompile()</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">re</span> <span class="o">:=</span> <span class="nx">regexp</span><span class="p">.</span><span class="nf">MustCompile</span><span class="p">(</span><span class="s">&#34;(gopher){2}&#34;</span><span class="p">)</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">re</span><span class="p">.</span><span class="nf">MatchString</span><span class="p">(</span><span class="s">&#34;gopher&#34;</span><span class="p">))</span> <span class="c1">//false
</span><span class="c1"></span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">re</span><span class="p">.</span><span class="nf">MatchString</span><span class="p">(</span><span class="s">&#34;gophergopher&#34;</span><span class="p">))</span> <span class="c1">//true
</span><span class="c1"></span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">re</span><span class="p">.</span><span class="nf">MatchString</span><span class="p">(</span><span class="s">&#34;gophergophergopher&#34;</span><span class="p">))</span> <span class="c1">//true
</span><span class="c1"></span>
 </code></pre></td></tr></table>
</div>
</div>
<h2 id="test用例">Test用例</h2>

<p>好处：</p>

<ul>
<li>减少Reviewer</li>
<li>降低修改代码错误</li>
<li>确保代码品质</li>
</ul>

<p>优势：</p>

<ul>
<li><p>不需要引用其他的，自带Testing套件</p></li>

<li><p>平行测试：如果一个测试情景超过1s就可以参考用平行测试</p></li>
</ul>

<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>

<tbody>
<tr>
<td>-v</td>
<td>显示通过的详细测试信息，默认只显示错误信息以及通过的概要</td>
</tr>

<tr>
<td>-c</td>
<td>生成用于运行测试的可执行文件，但不执行它。这个可执行文件会被命名为“pkg.test”，其中的“pkg”即为被测试代码包的导入路径的最后一个元素的名称。</td>
</tr>

<tr>
<td>-i</td>
<td>只是安装测试所依赖的包，不会编译执行</td>
</tr>

<tr>
<td>-o</td>
<td>指定编译生成的可执行文件名</td>
</tr>

<tr>
<td>-bench regexp</td>
<td>执行相应的 benchmarks，例如 -bench=.</td>
</tr>

<tr>
<td>-cover</td>
<td>开启测试覆盖率</td>
</tr>

<tr>
<td>-run regexp</td>
<td>只运行 regexp 匹配的函数，例如 -run=Array 那么就执行包含有 Array 开头的函数</td>
</tr>
</tbody>
</table>

<h3 id="单元测试"><strong>单元测试</strong></h3>

<h3 id="性能测试benchmark"><strong>性能测试Benchmark</strong></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="k">go</span> <span class="nx">test</span> <span class="o">-</span><span class="nx">v</span> <span class="o">-</span><span class="nx">bench</span><span class="p">=.</span> <span class="p">.</span>
<span class="k">go</span> <span class="nx">test</span> <span class="o">-</span><span class="nx">v</span> <span class="o">-</span><span class="nx">bench</span><span class="p">=.</span> <span class="o">-</span><span class="nx">run</span><span class="p">=</span><span class="nx">none</span> <span class="p">.</span>
<span class="k">go</span> <span class="nx">test</span> <span class="o">-</span><span class="nx">v</span> <span class="o">-</span><span class="nx">bench</span><span class="p">=.</span> <span class="o">-</span><span class="nx">run</span><span class="p">=</span><span class="nx">none</span> <span class="o">-</span><span class="nx">benchmem</span> <span class="p">.</span>

<span class="k">go</span> <span class="nx">test</span> <span class="o">-</span><span class="nx">v</span> <span class="o">-</span><span class="nx">bench</span><span class="p">=.</span> <span class="nx">int2str_test</span><span class="p">.</span><span class="k">go</span> <span class="o">-</span><span class="nx">benchmem</span>
<span class="k">go</span> <span class="nx">test</span> <span class="o">-</span><span class="nx">bench</span><span class="p">=.</span> <span class="o">-</span><span class="nx">cpu</span><span class="p">=</span><span class="mi">1</span> <span class="nx">benchmark</span><span class="o">/</span><span class="nx">goroutine_test</span><span class="p">.</span><span class="k">go</span>
 </code></pre></td></tr></table>
</div>
</div>
<h2 id="special-tips"><strong>Special Tips</strong></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">f1</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">b</span> <span class="kd">struct</span><span class="p">{}</span>
    <span class="nb">print</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">a</span><span class="p">,</span> <span class="s">&#34;\n&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">b</span><span class="p">,</span> <span class="s">&#34;\n&#34;</span><span class="p">)</span> <span class="c1">// Prints same address
</span><span class="c1"></span>    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">a</span> <span class="o">==</span> <span class="o">&amp;</span><span class="nx">b</span><span class="p">)</span>     <span class="c1">// Comparison returns false
</span><span class="c1"></span><span class="p">}</span>

<span class="kd">func</span> <span class="nf">f2</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">b</span> <span class="kd">struct</span><span class="p">{}</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;%p\n%p\n&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">a</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">b</span><span class="p">)</span> <span class="c1">// Again, same address
</span><span class="c1"></span>    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">a</span> <span class="o">==</span> <span class="o">&amp;</span><span class="nx">b</span><span class="p">)</span>          <span class="c1">// ...but the comparison returns true
</span><span class="c1"></span><span class="p">}</span>

<span class="c1">// 保留n位小数
</span><span class="c1"></span><span class="nx">fun</span> <span class="nf">Round</span><span class="p">(</span><span class="nx">f</span> <span class="kt">float64</span><span class="p">,</span> <span class="nx">n</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">float64</span> <span class="p">{</span>
    <span class="nx">pow10_n</span> <span class="o">:=</span> <span class="nx">math</span><span class="p">.</span><span class="nf">Pow10</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">math</span><span class="p">.</span><span class="nf">Trunc</span><span class="p">(</span> <span class="p">(</span><span class="nx">f</span><span class="o">+</span><span class="mf">0.5</span><span class="o">/</span><span class="nx">pow10_n</span><span class="p">)</span><span class="o">*</span><span class="nx">pow10_n</span> <span class="p">)</span> <span class="o">/</span> <span class="nx">pow10_n</span>
<span class="p">}</span>

<span class="c1">// for-range
</span><span class="c1">// 在Go的for…range循环中，Go始终使用值拷贝的方式代替被遍历的元素本身，简单来说，就是for…range中那个value，是一个值拷贝，而不是元素本身.
</span><span class="c1">// 当用&amp;取元素的地址时，实际上取到的是临时变量value的地址。
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">Foo</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">bar</span> <span class="kt">string</span>
<span class="p">}</span>
<span class="nx">list</span> <span class="o">:=</span> <span class="p">[]</span><span class="nx">Foo</span><span class="p">{</span>
    <span class="p">{</span><span class="s">&#34;A&#34;</span><span class="p">},</span>
    <span class="p">{</span><span class="s">&#34;B&#34;</span><span class="p">},</span>
    <span class="p">{</span><span class="s">&#34;C&#34;</span><span class="p">},</span>
<span class="p">}</span>
<span class="nx">list2</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="o">*</span><span class="nx">Foo</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nx">list</span><span class="p">))</span>
<span class="k">for</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">value</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">list</span> <span class="p">{</span>
    <span class="nx">list2</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">value</span>
<span class="p">}</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">list</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">list</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="c1">// {A} {B} {C}
</span><span class="c1"></span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">list2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">list2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">list2</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="c1">// &amp;{C} &amp;{C} &amp;{C}
</span><span class="c1"></span>
<span class="c1">// 过滤不分配
</span><span class="c1"></span><span class="nx">b</span> <span class="o">:=</span> <span class="nx">a</span><span class="p">[:</span><span class="mi">0</span><span class="p">]</span>
<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">x</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">a</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nf">f</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">b</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span> <span class="nx">x</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//获取一个字符串的字节数
</span><span class="c1"></span><span class="nx">utf8</span><span class="p">.</span><span class="nf">RuneCountInString</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span>
<span class="nb">len</span><span class="p">([]</span><span class="nb">rune</span><span class="p">(</span><span class="nx">str</span><span class="p">))</span>

<span class="c1">//拼接字符串
</span><span class="c1"></span><span class="nx">Strings</span><span class="p">.</span><span class="nf">Join</span><span class="p">()</span>

<span class="kd">var</span> <span class="nx">buffer</span> <span class="nx">bytes</span><span class="p">.</span><span class="nx">Buffer</span>
<span class="k">for</span><span class="p">{</span>
  <span class="k">if</span> <span class="nx">s</span><span class="p">,</span><span class="nx">ok</span> <span class="o">:=</span> <span class="nf">fun</span><span class="p">();</span> <span class="nx">ok</span><span class="p">{</span>
        <span class="nx">buffer</span><span class="p">.</span><span class="nf">WriteString</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>
  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="k">break</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nx">buffer</span><span class="p">.</span><span class="nf">String</span><span class="p">()</span>

<span class="c1">// 不要忘记停止ticker
</span><span class="c1"></span><span class="nx">ticker</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">NewTicker</span><span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
<span class="k">defer</span> <span class="nx">ticker</span><span class="p">.</span><span class="nf">Stop</span><span class="p">()</span>
<span class="c1">//在协程周期性的执行一些事情（打印状态日志，输出，计算等等）的时候非常有用。
</span><span class="c1"></span><span class="k">select</span><span class="p">{</span>
    <span class="k">case</span> <span class="nx">u</span><span class="o">:=&lt;-</span><span class="nx">ch1</span><span class="p">:</span>
      <span class="o">...</span>
    <span class="k">case</span> <span class="nx">u</span><span class="o">:=&lt;-</span><span class="nx">ch2</span><span class="p">:</span>
      <span class="o">...</span>
    <span class="k">case</span> <span class="o">&lt;-</span><span class="nx">ticker</span><span class="p">.</span><span class="nx">C</span><span class="p">:</span>
      <span class="nf">logState</span><span class="p">(</span><span class="nx">status</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">//限制处理频率
</span><span class="c1"></span><span class="nx">rate_per_sec</span> <span class="p">=</span> <span class="mi">10</span>
<span class="kd">var</span> <span class="nx">dur</span> <span class="nx">Duration</span> <span class="p">=</span> <span class="mf">1e9</span><span class="o">/</span><span class="nx">rate_pre_sec</span>
<span class="nx">chRate</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Tick</span><span class="p">(</span><span class="nx">dur</span><span class="p">)</span>
<span class="k">for</span> <span class="nx">req</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">requests</span><span class="p">{</span>
    <span class="o">&lt;-</span><span class="nx">chRate</span>
    <span class="k">go</span> <span class="nx">client</span><span class="p">.</span><span class="nf">Call</span><span class="p">(</span><span class="s">&#34;Service.Method&#34;</span><span class="p">,</span> <span class="nx">req</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="p">}</span>


<span class="c1">// dump goreoutine
</span><span class="c1"></span><span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">sigs</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Signal</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="nx">signal</span><span class="p">.</span><span class="nf">Notify</span><span class="p">(</span><span class="nx">sigs</span><span class="p">,</span> <span class="nx">syscall</span><span class="p">.</span><span class="nx">SIGQUIT</span><span class="p">)</span>
    <span class="nx">buf</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">20</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">{</span>
        <span class="o">&lt;-</span><span class="nx">sigs</span>
        <span class="nx">stacklen</span> <span class="o">:=</span> <span class="nx">runtime</span><span class="p">.</span><span class="nf">Stack</span><span class="p">(</span><span class="nx">buf</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
        <span class="nx">log</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;=== received SIGQUIT ===\n*** goroutine dump...\n%s\n*** end\n&#34;</span><span class="p">,</span> <span class="nx">buf</span><span class="p">[:</span><span class="nx">stacklen</span><span class="p">])</span>
    <span class="p">}</span>
<span class="p">}()</span>


<span class="c1">//函数“实现”接口
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">Tester</span> <span class="kd">interface</span> <span class="p">{</span>
    <span class="nf">Do</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">FuncDo</span> <span class="kd">func</span><span class="p">()</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">self</span> <span class="nx">FuncDo</span><span class="p">)</span> <span class="nf">Do</span><span class="p">()</span> <span class="p">{</span>
    <span class="nf">self</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">t</span> <span class="nx">Tester</span> <span class="p">=</span> <span class="nf">FuncDo</span><span class="p">(</span><span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
    <span class="nb">println</span><span class="p">(</span><span class="s">&#34;Hello, World!&#34;</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">t</span><span class="p">.</span><span class="nf">Do</span><span class="p">()</span>


<span class="c1">// type只能使用在interface
</span><span class="c1">//panic-recover 对重复解锁互斥锁引发的panic却是无用的
</span><span class="c1"></span>
 </code></pre></td></tr></table>
</div>
</div>
<p><strong>Tips</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">builtin函数</span> <span class="err">：</span>
<span class="nx">new</span> <span class="nx">和</span> <span class="nx">make的区别</span><span class="err">：</span>
<span class="nx">new</span>
<span class="kd">func</span> <span class="nb">new</span><span class="p">(</span><span class="nx">Type</span><span class="p">)</span> <span class="o">*</span><span class="nx">Type</span>

<span class="nx">make</span>
<span class="kd">func</span> <span class="nb">make</span><span class="p">(</span><span class="nx">t</span> <span class="nx">Type</span><span class="p">,</span> <span class="nx">size</span> <span class="o">...</span><span class="nx">IntegerType</span><span class="p">)</span> <span class="nx">Type</span>

<span class="nx">new</span> <span class="nx">计算类型大小</span><span class="err">，</span><span class="nx">分配零值内存</span><span class="err">，</span><span class="nx">返回指针</span><span class="err">。</span><span class="nx">适用于数组和结构体</span>
<span class="nx">make</span> <span class="nx">会被编译器翻译成具体的创建函数</span><span class="err">，</span><span class="nx">由其分配内存和初始化成员结构</span><span class="err">，</span><span class="nx">返回对象而非指针</span><span class="err">。</span><span class="nx">适用于切片</span><span class="err">、</span><span class="kd">map</span> <span class="nx">和</span> <span class="nx">channel</span>

 </code></pre></td></tr></table>
</div>
</div>
<h2 id="go为数不多的陷阱"><strong>Go为数不多的陷阱</strong></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// Go 语言为数不多的陷阱之Slice
</span><span class="c1"></span><span class="nx">arr</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">}</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">arr</span><span class="p">),</span> <span class="nb">cap</span><span class="p">(</span><span class="nx">arr</span><span class="p">))</span> <span class="c1">// 5 5
</span><span class="c1"></span><span class="nx">slice</span> <span class="o">:=</span> <span class="nx">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">slice</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nx">slice</span><span class="p">),</span> <span class="nb">cap</span><span class="p">(</span><span class="nx">slice</span><span class="p">))</span> <span class="c1">// [2] 1 4
</span><span class="c1"></span><span class="nx">slice</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">slice</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">slice</span><span class="p">)</span>                  <span class="c1">// [2,6,7,8]
</span><span class="c1"></span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">slice</span><span class="p">),</span> <span class="nb">cap</span><span class="p">(</span><span class="nx">slice</span><span class="p">))</span> <span class="c1">// 4,4
</span><span class="c1"></span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">arr</span><span class="p">)</span>                    <span class="c1">// [1,2,6,7,8]
</span><span class="c1">// 信条: 不对函数slice类型的参数append
</span><span class="c1"></span>
 </code></pre></td></tr></table>
</div>
</div>
<ul>
<li><a href="https://www.flysnow.org/2018/12/21/golang-sliceheader.html">参考 Go语言slice的本质-SliceHeader</a></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// Go 语言为数不多的陷阱之闭包
</span><span class="c1">// 闭包只是带有父函数的上下文（context）的函数
</span><span class="c1">// 闭包对父函数的context只是引用而不复制
</span><span class="c1">// Go 的函数返回值是通过堆栈返回的。return语句不是原子操作。
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">f6</span><span class="p">()</span> <span class="p">(</span><span class="nx">r</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">t</span> <span class="o">:=</span> <span class="mi">5</span>
    <span class="k">defer</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">t</span> <span class="p">=</span> <span class="nx">t</span> <span class="o">+</span> <span class="mi">5</span>
    <span class="p">}()</span>
    <span class="k">return</span> <span class="nx">t</span>
<span class="p">}</span>
<span class="c1">// 这里t虽然是闭包引用，但返回值r不是闭包引用
</span><span class="c1">// 可以拆解为
</span><span class="c1">// r = t
</span><span class="c1">// rval = r
</span><span class="c1">// t = t + 5
</span><span class="c1">// return rval
</span><span class="c1">// 所以输出：5
</span><span class="c1"></span>
<span class="kd">func</span> <span class="nf">f7</span><span class="p">()</span> <span class="p">(</span><span class="nx">r</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">defer</span> <span class="kd">func</span><span class="p">(</span><span class="nx">r</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">r</span> <span class="p">=</span> <span class="nx">r</span> <span class="o">+</span> <span class="mi">5</span>
  <span class="p">}(</span><span class="nx">r</span><span class="p">)</span>
  <span class="k">return</span> <span class="mi">1</span>
<span class="p">}</span>
<span class="c1">// 因为匿名函数的参数也是r，所以相当于是
</span><span class="c1">// 匿名函数的参数r = r + 5，不影响外部
</span><span class="c1">// 所以输出：1
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nb">println</span><span class="p">(</span><span class="nf">f6</span><span class="p">())</span> <span class="c1">// 5
</span><span class="c1"></span>    <span class="nb">println</span><span class="p">(</span><span class="nf">f7</span><span class="p">())</span> <span class="c1">// 1
</span><span class="c1"></span>
    <span class="kd">func</span> <span class="nf">test</span><span class="p">(){</span>
        <span class="nx">x</span><span class="p">,</span><span class="nx">y</span> <span class="o">:=</span> <span class="mi">10</span><span class="p">,</span><span class="mi">20</span>
        <span class="k">defer</span> <span class="kd">func</span><span class="p">(</span><span class="nx">i</span> <span class="kt">int</span><span class="p">){</span>
            <span class="nb">println</span><span class="p">(</span><span class="s">&#34;defer:&#34;</span><span class="p">,</span><span class="nx">i</span><span class="p">,</span><span class="nx">y</span><span class="p">)</span> <span class="c1">// y是闭包引用
</span><span class="c1"></span>        <span class="p">}(</span><span class="nx">x</span><span class="p">)</span> <span class="c1">// x被复制,复制的时候x是10
</span><span class="c1"></span>        <span class="nx">x</span><span class="o">+=</span> <span class="mi">10</span>
        <span class="nx">y</span><span class="o">+=</span> <span class="mi">100</span>
        <span class="nb">println</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="c1">// 20 120
</span><span class="c1"></span>    <span class="c1">// defer: 10 120
</span><span class="c1"></span>    <span class="k">return</span>
<span class="p">}</span>
<span class="c1">// 总结: 1谨记defer和return执行的顺序 2注意返回值是否为闭包引用
</span><span class="c1"></span>
 </code></pre></td></tr></table>
</div>
</div>
    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">leighj</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        2019-08-01 11:11
        
    </span>
  </p>
  
  
</div>
<div class="post-reward">
  <input type="checkbox" name="reward" id="reward" hidden />
  <label class="reward-button" for="reward">赞赏支持</label>
  <div class="qr-code">
    
    <label class="qr-code-image" for="reward">
        <img class="image" src="/images/wxpay.jpg">
        <span>微信打赏</span>
      </label>
    <label class="qr-code-image" for="reward">
        <img class="image" src="/images/alipay.jpg">
        <span>支付宝打赏</span>
      </label>
  </div>
</div><footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/Go/">Go</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/2019/07/26/ssh%e5%85%8d%e5%af%86%e7%99%bb%e5%bd%95%e9%85%8d%e7%bd%ae.html">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">SSH免秘登录配置</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        
      </nav>
    </footer>
    <script src="https://utteranc.es/client.js"
            repo="leighjpeter/blog"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/utterance">comments powered by utterance.</a></noscript>
  </article>
        </div>
        
  
  

  
    <script src="https://utteranc.es/client.js"
            repo="leighjpeter/leighjpeter/blog"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/utterance">comments powered by utterances.</a></noscript>

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:leighj@163.com" class="iconfont icon-email" title="email"></a>
      <a href="https://github.com/leighjpeter" class="iconfont icon-github" title="github"></a>
      <a href="https://weibo.com/p/1005051803322877" class="iconfont icon-weibo" title="weibo"></a>

</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2019
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">leighj</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>
<script type="text/javascript" src="/dist/even.f79f403f.min.js"></script>








</body>
</html>
